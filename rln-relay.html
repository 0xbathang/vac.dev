<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Privacy-preserving p2p economic spam protection in Waku v2</title><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="description" content="This post is going to give you an overview of how spam protection can be achieved in Waku Relay through rate-limiting nullifiers. We will cover a summary of spam-protection methods in centralized and p2p systems, and the solution overview and details of the economic spam-protection method. The open issues and future steps are discussed in the end."/><link rel="shortcut icon" href="/assets/logo/vac/favicon.ico"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:creator" content="vacp2p"/><meta name="twitter:site" content="@vacp2p"/><meta name="twitter:title" content="Privacy-preserving p2p economic spam protection in Waku v2"/><meta name="twitter:description" content="This post is going to give you an overview of how spam protection can be achieved in Waku Relay through rate-limiting nullifiers. We will cover a summary of spam-protection methods in centralized and p2p systems, and the solution overview and details of the economic spam-protection method. The open issues and future steps are discussed in the end."/><meta name="twitter:image" content="https://staging.vac.dev/compiled-assets/img/rain.png"/><meta property="og:url" content="https://staging.vac.dev//rln-relay"/><meta property="og:image" content="https://staging.vac.dev/compiled-assets/img/rain.png"/><meta property="og:site_name" content="Privacy-preserving p2p economic spam protection in Waku v2"/><meta property="og:title" content="Privacy-preserving p2p economic spam protection in Waku v2"/><meta property="og:description" content="This post is going to give you an overview of how spam protection can be achieved in Waku Relay through rate-limiting nullifiers. We will cover a summary of spam-protection methods in centralized and p2p systems, and the solution overview and details of the economic spam-protection method. The open issues and future steps are discussed in the end."/><meta name="next-head-count" content="16"/><link rel="preload" href="/_next/static/css/e068b41030ceede6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e068b41030ceede6.css" data-n-g=""/><link rel="preload" href="/_next/static/css/cdd95df0746869ac.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cdd95df0746869ac.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-a14325fd952bf0eb.js" defer=""></script><script src="/_next/static/chunks/framework-fc97f3f1282ce3ed.js" defer=""></script><script src="/_next/static/chunks/main-ada0258e433ba222.js" defer=""></script><script src="/_next/static/chunks/pages/_app-aa43738908a89379.js" defer=""></script><script src="/_next/static/chunks/eb1842f2-90eb16656390ba2a.js" defer=""></script><script src="/_next/static/chunks/399-b4b9981c243e7c94.js" defer=""></script><script src="/_next/static/chunks/22-651cfaa0b9f0d072.js" defer=""></script><script src="/_next/static/chunks/pages/%5B%5B...path%5D%5D-e5cc32395b198f36.js" defer=""></script><script src="/_next/static/ulkdS6VOmlR0pndRpqll2/_buildManifest.js" defer=""></script><script src="/_next/static/ulkdS6VOmlR0pndRpqll2/_ssgManifest.js" defer=""></script><script src="/_next/static/ulkdS6VOmlR0pndRpqll2/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><svg width="0" height="0" xmlns="http://www.w3.org/2000/svg" style="display:none"><defs><filter id="colored"><feColorMatrix type="matrix" values="1.00 0 0 0 0 0 1.00 0 0 0 0 0 1.00 0 0 0 0 0 1 0"></feColorMatrix></filter></defs></svg><style nonce="logos">
      #nprogress {
        pointer-events: none;
      }
      #nprogress .bar {
        background: #000000;
        position: fixed;
        z-index: 9999;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
      }
      #nprogress .peg {
        display: block;
        position: absolute;
        right: 0px;
        width: 100px;
        height: 100%;
        box-shadow: 0 0 10px #000000, 0 0 5px #000000;
        opacity: 1;
        -webkit-transform: rotate(3deg) translate(0px, -4px);
        -ms-transform: rotate(3deg) translate(0px, -4px);
        transform: rotate(3deg) translate(0px, -4px);
      }
      #nprogress .spinner {
        display: block;
        position: fixed;
        z-index: 1031;
        top: 15px;
        right: 15px;
      }
      #nprogress .spinner-icon {
        width: 18px;
        height: 18px;
        box-sizing: border-box;
        border: solid 2px transparent;
        border-top-color: #000000;
        border-left-color: #000000;
        border-radius: 50%;
        -webkit-animation: nprogresss-spinner 400ms linear infinite;
        animation: nprogress-spinner 400ms linear infinite;
      }
      .nprogress-custom-parent {
        overflow: hidden;
        position: relative;
      }
      .nprogress-custom-parent #nprogress .spinner,
      .nprogress-custom-parent #nprogress .bar {
        position: absolute;
      }
      @-webkit-keyframes nprogress-spinner {
        0% {
          -webkit-transform: rotate(0deg);
        }
        100% {
          -webkit-transform: rotate(360deg);
        }
      }
      @keyframes nprogress-spinner {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style><div class="Style_container__qv2Yk Styles_common_container__u_XHj template-container"><header class="Styles_container__5FUI_ Style_header__IYvBP undefined"><div class="Styles_innerWrapper__ZInvp"><div class="logo-holder button vac" style="display:inline-block"><svg width="45" height="43" viewBox="0 0 35 43" fill="none" xmlns="http://www.w3.org/2000/svg" class="vac-logo"><g clip-path="url(#clip0_917_3082)"><path d="M24.9034 14.8217C24.6824 11.2666 23.5308 7.8298 21.5623 4.84994C22.543 4.19721 23.7374 3.93844 24.9034 4.12603C25.492 4.23064 26.0472 4.4722 26.5233 4.83086C26.9994 5.18951 27.3828 5.65504 27.6421 6.18916C28.0141 7.1512 28.1335 8.19117 27.989 9.21147C27.9754 9.6728 27.8955 10.1299 27.7516 10.5688C27.6613 10.8504 27.5322 11.1183 27.3682 11.3651C27.166 11.69 26.9466 12.0041 26.7109 12.3062C26.1084 13.1206 25.5607 14.0073 24.9034 14.8217Z" fill="#999999"></path><path d="M16.7058 7.58268C15.8382 5.99003 14.5344 4.67263 12.9447 3.78217L10.9546 2.69631C10.9546 2.69631 13.2551 -0.778436 16.1945 0.162641C19.134 1.10372 18.1846 7.4017 17.5821 9.80869" fill="#4D4D4D"></path><path d="M20.3209 41.6243C17.4179 40.4118 16.2129 38.3668 14.6975 36.919C13.1821 35.4711 12.8717 29.3903 13.1638 24.6126C13.456 19.8348 17.4909 11.528 17.5822 9.80869C17.6735 8.08941 15.4643 5.17569 13.5655 3.78217C11.6491 2.2631 9.29769 1.38272 6.84668 1.2666L8.36207 2.51534C9.74965 3.67359 9.42101 3.98125 9.22018 6.26155C9.01935 8.54185 8.72722 15.6904 8.70896 21.8436C8.70896 30.3495 6.73713 32.7022 13.0178 38.8373C14.1564 40.1358 15.6863 41.0368 17.3814 41.4072C21.6902 43.036 24.228 43.2712 20.3209 41.6243Z" fill="#1A1A1A"></path><path d="M17.9839 7.07618C17.5904 9.58823 16.8212 12.0281 15.7016 14.3152C14.6765 16.6746 13.7925 19.0918 13.0543 21.5543C12.076 25.3846 11.8405 29.3642 12.3605 33.2816C12.4325 34.6426 12.8065 35.9712 13.4559 37.1726C14.1362 38.1272 14.9759 38.9596 15.939 39.6338C17.8321 41.3312 20.1651 42.4718 22.6761 42.9276C20.068 40.8547 18.189 38.0165 17.3083 34.8199C16.3002 31.5246 16.6412 27.9684 18.2577 24.9205C18.7142 24.0699 19.2436 23.2555 19.7731 22.4411L24.4653 15.3287C24.7022 15.0187 24.8815 14.6694 24.9948 14.2971C25.0769 13.891 25.0769 13.4727 24.9948 13.0665C24.3347 9.48034 22.792 6.11109 20.5034 3.25758C19.9266 2.35717 19.1529 1.59688 18.2395 1.033C17.3262 0.46911 16.2966 0.116066 15.2269 0C15.7121 0.03052 16.1783 0.198543 16.5699 0.484084C16.9616 0.769625 17.2622 1.16066 17.4361 1.61069C17.8159 2.51034 18.0085 3.47679 18.0021 4.45202C18.0507 5.32627 18.0446 6.20267 17.9839 7.07618Z" fill="#808080"></path><path d="M34.927 21.7174C34.8742 21.5895 34.8068 21.4681 34.7261 21.3554C34.5725 21.0145 34.3893 20.6875 34.1784 20.3781C34.0141 20.1429 33.8315 19.9257 33.6489 19.7085C33.2107 19.1294 33.0829 18.3874 32.5352 17.8988C32.2726 17.6504 32.0907 17.33 32.0126 16.9787C31.9346 16.6273 31.964 16.2609 32.097 15.9261C32.2066 15.6366 32.4074 15.4013 32.5352 15.1298C32.6706 14.7258 32.7195 14.2982 32.6786 13.8744C32.6378 13.4505 32.5081 13.0398 32.2979 12.6685C31.7956 11.6016 31.1838 10.5888 30.4721 9.64624C29.5227 8.32511 28.5185 7.05828 27.4596 5.82764C27.6672 6.89431 27.6423 7.99266 27.3865 9.04902C27.2386 9.62495 27.0432 10.1879 26.8023 10.7321C26.4264 11.4007 26.0118 12.0473 25.5608 12.6685C23.2238 16.2881 20.832 19.9076 18.349 23.4004C17.0435 25.5573 16.3321 28.0161 16.2859 30.5309C16.0848 32.9993 16.618 35.472 17.8195 37.6433C18.5687 38.8742 19.4502 40.021 20.4486 41.0637C21.0694 41.7334 21.7814 42.8735 22.6395 43.0726C22.7491 42.041 22.9499 40.6475 23.096 39.6159C23.3338 37.934 23.8782 36.3089 24.7027 34.8201C25.1895 33.7601 26.0543 32.9158 27.1309 32.4493C27.9135 32.2862 28.7218 32.2862 29.5044 32.4493C29.9422 32.4221 30.3812 32.4221 30.819 32.4493C31.2686 32.4735 31.7149 32.3597 32.097 32.1235C32.3186 31.968 32.5024 31.7655 32.6351 31.5307C32.7677 31.2959 32.8459 31.0347 32.8638 30.7662C32.9186 30.2791 32.9186 29.7874 32.8638 29.3003C32.8245 28.9868 32.8685 28.6686 32.9916 28.3773C33.2473 27.8525 34.0141 27.6172 34.0689 27.02C34.0476 26.7523 33.9665 26.4927 33.8315 26.2599C33.7604 26.1456 33.7228 26.014 33.7228 25.8798C33.7228 25.7456 33.7604 25.614 33.8315 25.4998C33.8315 25.4998 34.0506 25.355 34.1236 25.2464C34.2051 25.1396 34.2492 25.0093 34.2492 24.8754C34.2492 24.7415 34.2051 24.6112 34.1236 24.5044C33.9428 24.2955 33.8006 24.0566 33.7037 23.7986C33.695 23.6656 33.715 23.5323 33.7622 23.4075C33.8094 23.2827 33.8828 23.1692 33.9776 23.0747C34.1732 22.888 34.3945 22.7295 34.6348 22.6041C34.7511 22.5516 34.8541 22.4739 34.9362 22.3769C35.0183 22.2798 35.0776 22.1658 35.1095 22.0431C35.0688 21.9246 35.0069 21.8143 34.927 21.7174Z" fill="#CCCCCC"></path><path d="M34.3062 20.5771C34.478 20.8248 34.619 21.0922 34.7261 21.3734C34.8037 21.4816 34.8709 21.5967 34.9269 21.7173L34.3062 20.5771Z" fill="#CCCCCC"></path><path d="M10.133 33.4262C9.0523 28.5693 8.7138 23.5789 9.12886 18.6223C9.12886 16.1429 11.265 2.44302 7.79605 1.41145C4.85656 0.524668 2.53783 3.94512 2.53783 3.94512C0.667683 7.68216 -0.206002 11.8316 1.36513e-05 15.9982C2.30048 38.8193 17.6735 41.4615 18.2577 41.7149C18.2577 41.7149 11.4476 39.2898 10.133 33.4262Z" fill="#09212A"></path></g><defs><clipPath id="clip0_917_3082"><rect width="35" height="43"></rect></clipPath></defs></svg></div><div class="Styles_searchBox__5X2m1"><div class="Styles_container__ddCFx "><div class="logos-search-box Styles_searchBox__xWHyX"><div><input type="text" placeholder="Search Vac Research" value=""/></div></div></div></div></div></header><div class="page-info"><h1 style="display:none">Vac Research</h1><div class="page-info-sub"><i>Apr 03 2023</i><br/><span>staging.vac.dev</span></div></div><main class="undefined Styles_common_main__4v7gP Styles_common_main__4v7gP"><aside class="Styles_container__3yUcn Style_sidebar__mLS5A Styles_common_sidebar__QAVov hidden-scroll Styles_hideDesktopToggleButton__L_Rik"><div class="sidebar-toggle-button button Styles_mobile___qAwf"><svg width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 4h14c.55 0 1-.45 1-1s-.45-1-1-1H1c-.55 0-1 .45-1 1s.45 1 1 1Zm14 8H1c-.55 0-1 .45-1 1s.45 1 1 1h14c.55 0 1-.45 1-1s-.45-1-1-1Zm0-5H1c-.55 0-1 .45-1 1s.45 1 1 1h14c.55 0 1-.45 1-1s-.45-1-1-1Z" fill="#F2F2F2"></path></svg></div><div class="logo-holder button vac" style="display:inline-block"><svg width="45" height="43" viewBox="0 0 35 43" fill="none" xmlns="http://www.w3.org/2000/svg" class="vac-logo"><g clip-path="url(#clip0_917_3082)"><path d="M24.9034 14.8217C24.6824 11.2666 23.5308 7.8298 21.5623 4.84994C22.543 4.19721 23.7374 3.93844 24.9034 4.12603C25.492 4.23064 26.0472 4.4722 26.5233 4.83086C26.9994 5.18951 27.3828 5.65504 27.6421 6.18916C28.0141 7.1512 28.1335 8.19117 27.989 9.21147C27.9754 9.6728 27.8955 10.1299 27.7516 10.5688C27.6613 10.8504 27.5322 11.1183 27.3682 11.3651C27.166 11.69 26.9466 12.0041 26.7109 12.3062C26.1084 13.1206 25.5607 14.0073 24.9034 14.8217Z" fill="#999999"></path><path d="M16.7058 7.58268C15.8382 5.99003 14.5344 4.67263 12.9447 3.78217L10.9546 2.69631C10.9546 2.69631 13.2551 -0.778436 16.1945 0.162641C19.134 1.10372 18.1846 7.4017 17.5821 9.80869" fill="#4D4D4D"></path><path d="M20.3209 41.6243C17.4179 40.4118 16.2129 38.3668 14.6975 36.919C13.1821 35.4711 12.8717 29.3903 13.1638 24.6126C13.456 19.8348 17.4909 11.528 17.5822 9.80869C17.6735 8.08941 15.4643 5.17569 13.5655 3.78217C11.6491 2.2631 9.29769 1.38272 6.84668 1.2666L8.36207 2.51534C9.74965 3.67359 9.42101 3.98125 9.22018 6.26155C9.01935 8.54185 8.72722 15.6904 8.70896 21.8436C8.70896 30.3495 6.73713 32.7022 13.0178 38.8373C14.1564 40.1358 15.6863 41.0368 17.3814 41.4072C21.6902 43.036 24.228 43.2712 20.3209 41.6243Z" fill="#1A1A1A"></path><path d="M17.9839 7.07618C17.5904 9.58823 16.8212 12.0281 15.7016 14.3152C14.6765 16.6746 13.7925 19.0918 13.0543 21.5543C12.076 25.3846 11.8405 29.3642 12.3605 33.2816C12.4325 34.6426 12.8065 35.9712 13.4559 37.1726C14.1362 38.1272 14.9759 38.9596 15.939 39.6338C17.8321 41.3312 20.1651 42.4718 22.6761 42.9276C20.068 40.8547 18.189 38.0165 17.3083 34.8199C16.3002 31.5246 16.6412 27.9684 18.2577 24.9205C18.7142 24.0699 19.2436 23.2555 19.7731 22.4411L24.4653 15.3287C24.7022 15.0187 24.8815 14.6694 24.9948 14.2971C25.0769 13.891 25.0769 13.4727 24.9948 13.0665C24.3347 9.48034 22.792 6.11109 20.5034 3.25758C19.9266 2.35717 19.1529 1.59688 18.2395 1.033C17.3262 0.46911 16.2966 0.116066 15.2269 0C15.7121 0.03052 16.1783 0.198543 16.5699 0.484084C16.9616 0.769625 17.2622 1.16066 17.4361 1.61069C17.8159 2.51034 18.0085 3.47679 18.0021 4.45202C18.0507 5.32627 18.0446 6.20267 17.9839 7.07618Z" fill="#808080"></path><path d="M34.927 21.7174C34.8742 21.5895 34.8068 21.4681 34.7261 21.3554C34.5725 21.0145 34.3893 20.6875 34.1784 20.3781C34.0141 20.1429 33.8315 19.9257 33.6489 19.7085C33.2107 19.1294 33.0829 18.3874 32.5352 17.8988C32.2726 17.6504 32.0907 17.33 32.0126 16.9787C31.9346 16.6273 31.964 16.2609 32.097 15.9261C32.2066 15.6366 32.4074 15.4013 32.5352 15.1298C32.6706 14.7258 32.7195 14.2982 32.6786 13.8744C32.6378 13.4505 32.5081 13.0398 32.2979 12.6685C31.7956 11.6016 31.1838 10.5888 30.4721 9.64624C29.5227 8.32511 28.5185 7.05828 27.4596 5.82764C27.6672 6.89431 27.6423 7.99266 27.3865 9.04902C27.2386 9.62495 27.0432 10.1879 26.8023 10.7321C26.4264 11.4007 26.0118 12.0473 25.5608 12.6685C23.2238 16.2881 20.832 19.9076 18.349 23.4004C17.0435 25.5573 16.3321 28.0161 16.2859 30.5309C16.0848 32.9993 16.618 35.472 17.8195 37.6433C18.5687 38.8742 19.4502 40.021 20.4486 41.0637C21.0694 41.7334 21.7814 42.8735 22.6395 43.0726C22.7491 42.041 22.9499 40.6475 23.096 39.6159C23.3338 37.934 23.8782 36.3089 24.7027 34.8201C25.1895 33.7601 26.0543 32.9158 27.1309 32.4493C27.9135 32.2862 28.7218 32.2862 29.5044 32.4493C29.9422 32.4221 30.3812 32.4221 30.819 32.4493C31.2686 32.4735 31.7149 32.3597 32.097 32.1235C32.3186 31.968 32.5024 31.7655 32.6351 31.5307C32.7677 31.2959 32.8459 31.0347 32.8638 30.7662C32.9186 30.2791 32.9186 29.7874 32.8638 29.3003C32.8245 28.9868 32.8685 28.6686 32.9916 28.3773C33.2473 27.8525 34.0141 27.6172 34.0689 27.02C34.0476 26.7523 33.9665 26.4927 33.8315 26.2599C33.7604 26.1456 33.7228 26.014 33.7228 25.8798C33.7228 25.7456 33.7604 25.614 33.8315 25.4998C33.8315 25.4998 34.0506 25.355 34.1236 25.2464C34.2051 25.1396 34.2492 25.0093 34.2492 24.8754C34.2492 24.7415 34.2051 24.6112 34.1236 24.5044C33.9428 24.2955 33.8006 24.0566 33.7037 23.7986C33.695 23.6656 33.715 23.5323 33.7622 23.4075C33.8094 23.2827 33.8828 23.1692 33.9776 23.0747C34.1732 22.888 34.3945 22.7295 34.6348 22.6041C34.7511 22.5516 34.8541 22.4739 34.9362 22.3769C35.0183 22.2798 35.0776 22.1658 35.1095 22.0431C35.0688 21.9246 35.0069 21.8143 34.927 21.7174Z" fill="#CCCCCC"></path><path d="M34.3062 20.5771C34.478 20.8248 34.619 21.0922 34.7261 21.3734C34.8037 21.4816 34.8709 21.5967 34.9269 21.7173L34.3062 20.5771Z" fill="#CCCCCC"></path><path d="M10.133 33.4262C9.0523 28.5693 8.7138 23.5789 9.12886 18.6223C9.12886 16.1429 11.265 2.44302 7.79605 1.41145C4.85656 0.524668 2.53783 3.94512 2.53783 3.94512C0.667683 7.68216 -0.206002 11.8316 1.36513e-05 15.9982C2.30048 38.8193 17.6735 41.4615 18.2577 41.7149C18.2577 41.7149 11.4476 39.2898 10.133 33.4262Z" fill="#09212A"></path></g><defs><clipPath id="clip0_917_3082"><rect width="35" height="43"></rect></clipPath></defs></svg></div><div class="Styles_desktop__VH2y3 defaultSidebar Styles_container__4YC7p"><nav class="sidebarNav hidden-scroll"><ul class="sidebar-menu mainMenu Styles_menu__izFC1"><li class="Styles_menuItem__BqRqE menuitem level-0"><span></span><ul class="sidebar-menu  Styles_menu__izFC1"><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Main" href="/">Main</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="principles" href="/principles">Principles</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Research areas" href="/research-areas">Research areas</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Projects" href="/projects">Projects</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Open Research Problems" href="/open-problems">Open Research Problems</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="publications" href="/publications">Publications</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="contribute" href="/contribute">Contribute</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="media" href="/media">Media</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li></ul><br/></li></ul><br/><ul class="sidebar-menu subMenu Styles_menu__izFC1"><li class="Styles_menuItem__BqRqE menuitem level-0"><a class="" title="research" href="/research">Research</a><ul class="sidebar-menu  Styles_menu__izFC1"><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="The Future of Waku Network: Scaling, Incentivization, and Heterogeneity" href="/future-of-waku-network">The Future of Waku Network: Scaling, Incentivization, and Heterogeneity</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Waku for All Decentralized Applications and Infrastructures" href="/waku-for-all">Waku for All Decentralized Applications and Infrastructures</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Building Privacy-Protecting Infrastructure" href="/building-privacy-protecting-infrastructure">Building Privacy-Protecting Infrastructure</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Waku Privacy and Anonymity Analysis Part I: Definitions and Waku Relay" href="/wakuv2-relay-anon">Waku Privacy and Anonymity Analysis Part I: Definitions and Waku Relay</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Noise handshakes as key-exchange mechanism for Waku" href="/wakuv2-noise">Noise handshakes as key-exchange mechanism for Waku</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Waku v2 Ambient Peer Discovery" href="/wakuv2-apd">Waku v2 Ambient Peer Discovery</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Introducing nwaku" href="/introducing-nwaku">Introducing nwaku</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li><span class="button">...</span></li></ul><br/></li></ul><div class="external_links"><div><div class="menuitem-title"><span class="cap">Resources</span></div><ul><li><a href="https://rfc.vac.dev/" target="_blank">&gt; Specs/RFCs</a></li><li><a href="https://forum.vac.dev/" target="_blank">&gt; Forum</a></li><li><a href="https://waku.org" target="_blank">&gt; Waku.org</a></li></ul></div></div></nav></div></aside><article class="Styles_container__pG0bG Style_content__NTXHZ Styles_common_content__Myi5Z"><div class="Style_container__qc2tD"><h2 class="Style_container__eSI4Q serif">Privacy-preserving p2p economic spam protection in Waku v2</h2><div class="serif"><i>Mar 05 2021</i><i> - </i>by<!-- --><a title="sanaztaheri" href="/authors/sanaztaheri"><span><i> <!-- -->sanaztaheri<!-- --></i></span></a></div></div><h1><a class="anchor" id="introduction"></a><a class="ha" href="#introduction">Introduction<!-- --></a></h1>
<!-- --><p>This post is going to give you an overview of how spam protection can be achieved in Waku Relay protocol<!-- --><sup><a id="user-content-fnref-2" data-footnote-ref="true" aria-describedby="footnote-label" href="/rln-relay#user-content-fn-2">1<!-- --></a></sup> through Rate-Limiting Nullifiers<!-- --><sup><a id="user-content-fnref-3" data-footnote-ref="true" aria-describedby="footnote-label" href="/rln-relay#user-content-fn-3">2<!-- --></a></sup> <!-- --><sup><a id="user-content-fnref-4" data-footnote-ref="true" aria-describedby="footnote-label" href="/rln-relay#user-content-fn-4">3<!-- --></a></sup> or RLN for short.<!-- --></p>
<!-- --><figure class="rehype-figure"><img src="/compiled-assets/img/rln-relay/rln-relay-overview.png" alt="Figure 1: An overview of privacy-preserving p2p economic spam protection in Waku v2 RLN-Relay protocol."/><figcaption>Figure 1: An overview of privacy-preserving p2p economic spam protection in Waku v2 RLN-Relay protocol.<!-- --></figcaption></figure>
<!-- --><h2><a class="anchor" id="what-do-we-mean-by-spamming"></a><a class="ha" href="#what-do-we-mean-by-spamming">What do we mean by spamming?<!-- --></a></h2>
<!-- --><p>In centralized messaging systems, a spammer usually indicates an entity that uses the messaging system to send an unsolicited message (spam) to large numbers of recipients. However, in Waku with a p2p architecture, spam messages not only affect the recipients but also all the other peers involved in the routing process as they have to spend their computational power/bandwidth/storage capacity on processing spam messages. As such, we define a spammer as an entity that uses the messaging system to publish a large number of messages in a short amount of time. The messages issued in this way are called spam. In this definition, we disregard the intention of the spammer as well as the content of the message and the number of recipients.<!-- --></p>
<!-- --><h2><a class="anchor" id="possible-solutions"></a><a class="ha" href="#possible-solutions">Possible Solutions<!-- --></a></h2>
<!-- --><p>Has the spamming issue been addressed before? Of course yes! Here is an overview of the spam protection techniques with their trade-offs and use-cases. In this overview, we distinguish between protection techniques that are targeted for centralized messaging systems and those for p2p architectures.<!-- --></p>
<!-- --><h3><a class="anchor" id="centralized-messaging-systems"></a><a class="ha" href="#centralized-messaging-systems">Centralized Messaging Systems<!-- --></a></h3>
<!-- --><p>In traditional centralized messaging systems, spam usually signifies unsolicited messages sent in bulk or messages with malicious content like malware. Protection mechanisms include<!-- --></p>
<!-- --><ul>
<!-- --><li>authentication through some piece of personally identifiable information e.g., phone number<!-- --></li>
<!-- --><li>checksum-based filtering to protect against messages sent in bulk<!-- --></li>
<!-- --><li>challenge-response systems<!-- --></li>
<!-- --><li>content filtering on the server or via a proxy application<!-- --></li>
<!-- --></ul>
<!-- --><p>These methods exploit the fact that the messaging system is centralized and a global view of the users&#x27; activities is available based on which spamming patterns can be extracted and defeated accordingly.  Moreover, users are associated with an identifier e.g., a username which enables the server to profile each user e.g., to detect suspicious behavior like spamming. Such profiling possibility is against the user&#x27;s anonymity and privacy.<!-- --></p>
<!-- --><p>Among the techniques enumerated above, authentication through phone numbers is a some-what economic-incentive measure as providing multiple valid phone numbers will be expensive for the attacker. Notice that while using an expensive authentication method can reduce the number of accounts owned by a single spammer, cannot address the spam issue entirely. This is because the spammer can still send bulk messages through one single account. For this approach to be effective, a centralized mediator is essential. That is why such a solution would not fit the p2p environments where no centralized control exists.<!-- --></p>
<!-- --><h3><a class="anchor" id="p2p-systems"></a><a class="ha" href="#p2p-systems">P2P Systems<!-- --></a></h3>
<!-- --><p>What about spam prevention in p2p messaging platforms? There are two techniques, namely <!-- --><em>Proof of Work<!-- --></em><sup><a id="user-content-fnref-8" data-footnote-ref="true" aria-describedby="footnote-label" href="/rln-relay#user-content-fn-8">7<!-- --></a></sup>  deployed by Whisper<!-- --><sup><a id="user-content-fnref-9" data-footnote-ref="true" aria-describedby="footnote-label" href="/rln-relay#user-content-fn-9">8<!-- --></a></sup> and <!-- --><em>Peer scoring<!-- --></em><sup><a id="user-content-fnref-6" data-footnote-ref="true" aria-describedby="footnote-label" href="/rln-relay#user-content-fn-6">9<!-- --></a></sup> method (namely reputation-based approach) adopted by LibP2P. However, each of these solutions has its own shortcomings for real-life use-cases as explained below.<!-- --></p>
<!-- --><h4><a class="anchor" id="proof-of-work"></a><a class="ha" href="#proof-of-work">Proof of work<!-- --></a></h4>
<!-- --><p>The idea behind the Proof Of Work i.e., POW<!-- --><sup><a id="user-content-fnref-8-2" data-footnote-ref="true" aria-describedby="footnote-label" href="/rln-relay#user-content-fn-8">7<!-- --></a></sup> is to make messaging a computationally costly operation hence lowering the messaging rate of <!-- --><strong>all<!-- --></strong> the peers including the spammers. In specific, the message publisher has to solve a puzzle and the puzzle is to find a nonce such that the hash of the message concatenated with the nonce has at least z leading zeros. z is known as the difficulty of the puzzle. Since the hash function is one-way, peers have to brute-force to find a nonce. Hashing is a computationally-heavy operation so is the brute-force. While solving the puzzle is computationally expensive, it is comparatively cheap to verify the solution.<!-- --></p>
<!-- --><p>POW is also used as the underlying mining algorithm in Ethereum and Bitcoin blockchain. There, the goal is to contain the mining speed and allow the decentralized network to come to a consensus, or agree on things like account balances and the order of transactions.<!-- --></p>
<!-- --><p>While the use of POW makes perfect sense in Ethereum / Bitcoin blockchain, it shows practical issues in heterogeneous p2p messaging systems with resource-restricted peers. Some peers won&#x27;t be able to carry the designated computation and will be effectively excluded. Such exclusion showed to be practically an issue in applications like Status, which used to rely on POW for spam-protection, to the extent that the difficulty level had to be set close to zero.<!-- --></p>
<!-- --><h4><a class="anchor" id="peer-scoring"></a><a class="ha" href="#peer-scoring">Peer Scoring<!-- --></a></h4>
<!-- --><p>The peer scoring method<!-- --><sup><a id="user-content-fnref-6-2" data-footnote-ref="true" aria-describedby="footnote-label" href="/rln-relay#user-content-fn-6">9<!-- --></a></sup> that is utilized by libp2p is to limit the number of messages issued by a peer in connection to another peer. That is each peer monitors all the peers to which it is directly connected and adjusts their messaging quota i.e., to route or not route their messages depending on their past activities. For example, if a peer detects its neighbor is sending more than x messages per month, can drop its quota to z.x where z is less than one.  The shortcoming of this solution is that scoring is based on peers&#x27; local observations and the concept of the score is defined in relation to one single peer. This leaves room for an attack where a spammer can make connections to k peers in the system and publishes k.(x-1)  messages by exploiting all of its k connections. Another attack scenario is through botnets consisting of a large number of e.g., a million bots. The attacker rents a botnet and inserts each of them as a legitimate peer to the network and each can publish x-1 messages per month<!-- --><sup><a id="user-content-fnref-7" data-footnote-ref="true" aria-describedby="footnote-label" href="/rln-relay#user-content-fn-7">10<!-- --></a></sup>.<!-- --></p>
<!-- --><h4><a class="anchor" id="economic-incentive-spam-protection"></a><a class="ha" href="#economic-incentive-spam-protection">Economic-Incentive Spam protection<!-- --></a></h4>
<!-- --><p>Is this the end of our spam-protection journey? Shall we simply give up and leave spammers be? Certainly not!
Waku RLN-Relay gives us a p2p spam-protection method which:<!-- --></p>
<!-- --><ul>
<!-- --><li>suits <!-- --><strong>p2p<!-- --></strong> systems and does not rely on any central entity.<!-- --></li>
<!-- --><li>is <!-- --><strong>efficient<!-- --></strong>  i.e., with no unreasonable computational, storage, memory, and bandwidth requirement! as such, it fits the network of <!-- --><strong>heterogeneous<!-- --></strong> peers.<!-- --></li>
<!-- --><li>respects users <!-- --><strong>privacy<!-- --></strong> unlike reputation-based and centralized methods.<!-- --></li>
<!-- --><li>deploys <!-- --><strong>economic-incentives<!-- --></strong> to contain spammers&#x27; activity. Namely, there is a financial sacrifice for those who want to spam the system. How? follow along ...<!-- --></li>
<!-- --></ul>
<!-- --><p>We devise a general rule to save everyone&#x27;s life and that is<!-- --></p>
<!-- --><p><strong>No one can publish more than M messages per epoch without being financially charged!<!-- --></strong></p>
<!-- --><p>We set M to 1 for now, but this can be any arbitrary value. You may be thinking &quot;This is too restrictive! Only one per epoch?&quot;. Don&#x27;t worry, we set the epoch to a reasonable value so that it does not slow down the communication of innocent users but will make the life of spammers harder! Epoch here can be every second, as defined by UTC date-time +-20s.<!-- --></p>
<!-- --><p>The remainder of this post is all about the story of how to enforce this limit on each user&#x27;s messaging rate as well as how to impose the financial cost when the limit gets violated.  This brings us to the Rate Limiting Nullifiers and how we integrate this technique into Waku v2 (in specific the Waku Relay protocol) to protect our valuable users against spammers.<!-- --></p>
<!-- --><h1><a class="anchor" id="technical-terms"></a><a class="ha" href="#technical-terms">Technical Terms<!-- --></a></h1>
<!-- --><p><strong>Zero-knowledge proof<!-- --></strong>: Zero-knowledge proof (ZKP)<!-- --><sup><a id="user-content-fnref-14" data-footnote-ref="true" aria-describedby="footnote-label" href="/rln-relay#user-content-fn-14">11<!-- --></a></sup> allows a <!-- --><em>prover<!-- --></em> to show a <!-- --><em>verifier<!-- --></em> that they know something, without revealing what that something is. This means you can do the trust-minimized computation that is also privacy-preserving. As a basic example, instead of showing your ID when going to a bar you simply give them proof that you are over 18, without showing the doorman your id. In this write-up, by ZKP we essentially mean zkSNARK<!-- --><sup><a id="user-content-fnref-15" data-footnote-ref="true" aria-describedby="footnote-label" href="/rln-relay#user-content-fn-15">12<!-- --></a></sup> which is one of the many types of ZKPs.<!-- --></p>
<!-- --><p><strong>Threshold Secret Sharing Scheme<!-- --></strong>: (m,n) Threshold secret-sharing is a method by which you can split a secret value s into n pieces in a way that the secret s can be reconstructed by having m pieces (m &lt;= n). The economic-incentive spam protection utilizes a (2,n) secret sharing realized by Shamir Secret Sharing Scheme<!-- --><sup><a id="user-content-fnref-13" data-footnote-ref="true" aria-describedby="footnote-label" href="/rln-relay#user-content-fn-13">13<!-- --></a></sup>.<!-- --></p>
<!-- --><h1><a class="anchor" id="overview-economic-incentive-spam-protection-through-rate-limiting-nullifiers"></a><a class="ha" href="#overview-economic-incentive-spam-protection-through-rate-limiting-nullifiers">Overview: Economic-Incentive Spam protection through Rate Limiting Nullifiers<!-- --></a></h1>
<!-- --><p><strong>Context<!-- --></strong>: We started the idea of economic-incentive spam protection more than a year ago and conducted a feasibility study to identify blockers and unknowns. The results are published in our prior <!-- --><a href="https://vac.dev/feasibility-semaphore-rate-limiting-zksnarks">post<!-- --></a>. Since then major progress has been made and the prior identified blockers that are listed below are now addressed. Kudos to <!-- --><a href="https://github.com/barryWhiteHat">Barry WhiteHat<!-- --></a>, <!-- --><a href="https://github.com/kilic">Onur Kilic<!-- --></a>, <!-- --><a href="https://github.com/weijiekoh/perpetualpowersoftau">Koh Wei Jie<!-- --></a> for all of their hard work, research, and development which made this progress possible.<!-- --></p>
<!-- --><ul>
<!-- --><li>the proof time<!-- --><sup><a id="user-content-fnref-22" data-footnote-ref="true" aria-describedby="footnote-label" href="/rln-relay#user-content-fn-22">14<!-- --></a></sup> which was initially in the order of minutes ~10 mins and now is almost 0.5 seconds<!-- --></li>
<!-- --><li>the prover key size<!-- --><sup><a id="user-content-fnref-21" data-footnote-ref="true" aria-describedby="footnote-label" href="/rln-relay#user-content-fn-21">15<!-- --></a></sup> which was initially ~110MB and now is ~3.9MB<!-- --></li>
<!-- --><li>the lack of Shamir logic<!-- --><sup><a id="user-content-fnref-19" data-footnote-ref="true" aria-describedby="footnote-label" href="/rln-relay#user-content-fn-19">16<!-- --></a></sup> which is now implemented and part of the RLN repository<!-- --><sup><a id="user-content-fnref-4-2" data-footnote-ref="true" aria-describedby="footnote-label" href="/rln-relay#user-content-fn-4">3<!-- --></a></sup></li>
<!-- --><li>the concern regarding the potential multi-party computation for the trusted setup of zkSNARKs which got resolved<!-- --><sup><a id="user-content-fnref-20" data-footnote-ref="true" aria-describedby="footnote-label" href="/rln-relay#user-content-fn-20">17<!-- --></a></sup></li>
<!-- --><li>the lack of end-to-end integration that now we made it possible, have it implemented, and are going to present it in this post. New blockers are also sorted out during the e2e integration which we will discuss in the <!-- --><a href="/rln-relay#feasibility-and-open-issues">Feasibility and Open Issues<!-- --></a> section.<!-- --></li>
<!-- --></ul>
<!-- --><p>Now that you have more context, let&#x27;s see how the final solution works. The fundamental point is to make it economically costly to send more than your share of messages and to do so in a privacy-preserving and e2e fashion. To do that we have the following components:<!-- --></p>
<!-- --><ul>
<!-- --><li>1- <!-- --><strong>Group<!-- --></strong>: We manage all the peers inside a large group (later we can split peers into smaller groups, but for now consider only one). The group management is done via a smart contract which is devised for this purpose and is deployed on the Ethereum blockchain.<!-- --></li>
<!-- --><li>2- <!-- --><strong>Membership<!-- --></strong>: To be able to send messages and in specific for the published messages to get routed by all the peers, publishing peers have to register to the group. Membership involves setting up public and private key pairs (think of it as the username and password). The private key remains at the user side but the public key becomes a part of the group information on the contract (publicly available) and everyone has access to it. Public keys are not human-generated (like usernames) and instead they are random numbers, as such, they do not reveal any information about the owner (think of public keys as pseudonyms). Registration is mandatory for the users who want to publish a message, however, users who only want to listen to the messages are more than welcome and do not have to register in the group.<!-- --></li>
<!-- --><li><strong>Membership fee<!-- --></strong>: Membership is not for free! each peer has to lock a certain amount of funds during the registration (this means peers have to have an Ethereum account with sufficient balance for this sake). This fund is safely stored on the contract and remains intact unless the peer attempts to break the rules and publish more than one message per epoch.<!-- --></li>
<!-- --><li><strong>Zero-knowledge Proof of membership<!-- --></strong>: Do you want your message to get routed to its destination, fine, but you have to prove that you are a member of the group (sorry, no one can escape the registration phase!). Now, you may be thinking that should I attach my public key to my message to prove my membership? Absolutely Not! we said that our solution respects privacy! membership proofs are done in a zero-knowledge manner that is each message will carry cryptographic proof asserting that &quot;the message is generated by one of the current members of the group&quot;, so your identity remains private and your anonymity is preserved!<!-- --></li>
<!-- --><li><strong>Slashing through secret sharing<!-- --></strong>: Till now it does not seem like we can catch spammers, right? yes, you are right! now comes the exciting part, detecting spammers and slashing them. The core idea behind the slashing is that each publishing peer (not routing peers!) has to integrate a secret share of its private key inside the message. The secret share is deterministically computed over the private key and the current epoch. The content of this share is harmless for the peer&#x27;s privacy (it looks random) unless the peer attempts to publish more than one message in the same epoch hence disclosing more than one secret share of its private key. Indeed two distinct shares of the private key under the same epoch are enough to reconstruct the entire private key. Then what should you do with the recovered private key? hurry up! go to the contract and withdraw the private key and claim its fund and get rich!! Are you thinking what if spammers attach junk values instead of valid secret shares? Of course, that wouldn&#x27;t be cool! so, there is a zero-knowledge proof for this sake as well where the publishing peer has to prove that the secret shares are generated correctly.<!-- --></li>
<!-- --></ul>
<!-- --><p>A high-level overview of the economic spam protection is shown in Figure 1.<!-- --></p>
<!-- --><h1><a class="anchor" id="flow"></a><a class="ha" href="#flow">Flow<!-- --></a></h1>
<!-- --><p>In this section, we describe the flow of the economic-incentive spam detection mechanism from the viewpoint of a single peer. An overview of this flow is provided in Figure 3.<!-- --></p>
<!-- --><h2><a class="anchor" id="setup-and-registration"></a><a class="ha" href="#setup-and-registration">Setup and Registration<!-- --></a></h2>
<!-- --><p>A peer willing to publish a message is required to register. Registration is moderated through a smart contract deployed on the Ethereum blockchain. The state of the contract contains the list of registered members&#x27; public keys. An overview of registration is illustrated in Figure 2.<!-- --></p>
<!-- --><figure class="rehype-figure"><img src="/compiled-assets/img/rln-relay/rln-relay.png" alt="Figure 2: Registration"/><figcaption>Figure 2: Registration<!-- --></figcaption></figure>
<!-- --><h2><a class="anchor" id="maintaining-the-membership-merkle-tree"></a><a class="ha" href="#maintaining-the-membership-merkle-tree">Maintaining the membership Merkle Tree<!-- --></a></h2>
<!-- --><p>The ZKP of membership that we mentioned before relies on the representation of the entire group as a <!-- --><a href="">Merkle Tree<!-- --></a>. The tree construction and maintenance is delegated to the peers (the initial idea was to keep the tree on the chain as part of the contract, however, the cost associated with member deletion and insertion was high and unreasonable, please see <!-- --><a href="/rln-relay#Feasibility-and-Open-Issues">Feasibility and Open Issues<!-- --></a> for more details). As such, each peer needs to build the tree locally and sync itself with the contract updates (peer insertion and deletion) to mirror them on its tree.
Two pieces of information of the tree are important as they enable peers to generate zero-knowledge proofs. One is the root of the tree and the other is the membership proof (or the authentication path). The tree root is public information whereas the membership proof is private data (or more precisely the index of the peer in the tree).<!-- --></p>
<!-- --><h2><a class="anchor" id="publishing"></a><a class="ha" href="#publishing">Publishing<!-- --></a></h2>
<!-- --><p>In order to publish at a given epoch, each message must carry a proof i.e., a zero-knowledge proof signifying that the publishing peer is a  registered member, and has not exceeded the messaging rate at the given epoch.<!-- --></p>
<!-- --><p>Recall that the enforcement of the messaging rate was through associating a secret shared version of the peer&#x27;s <!-- --><code>sk</code> into the message together with a ZKP that the secret shares are constructed correctly. As for the secret sharing part, the peer generates the following data:<!-- --></p>
<!-- --><ol>
<!-- --><li><code>shareX</code></li>
<!-- --><li><code>shareY</code></li>
<!-- --><li><code>nullifier</code></li>
<!-- --></ol>
<!-- --><p>The pair (<!-- --><code>shareX</code>, <!-- --><code>shareY</code>)  is the secret shared version of <!-- --><code>sk</code> that are generated using Shamir secret sharing scheme. Having two such pairs for an identical <!-- --><code>nullifier</code> results in full disclosure of peer&#x27;s <!-- --><code>sk</code> and hence burning the associated deposit. Note that the <!-- --><code>nullifier</code> is a deterministic value derived from <!-- --><code>sk</code> and <!-- --><code>epoch</code> therefore any two messages issued by the same peer (i.e., using the same <!-- --><code>sk</code>) for the same <!-- --><code>epoch</code> are guaranteed to have identical <!-- --><code>nullifier</code>s.<!-- --></p>
<!-- --><p>Finally, the peer generates a zero-knowledge proof  <!-- --><code>zkProof</code>  asserting the membership of the peer in the group and the correctness of the attached secret share (<!-- --><code>shareX</code>, <!-- --><code>shareY</code>) and the <!-- --><code>nullifier</code>. In order to generate a valid proof, the peer needs to have two private inputs i.e., its <!-- --><code>sk</code> and its authentication path. Other inputs are the tree root, epoch, and the content of the message.<!-- --></p>
<!-- --><p><strong>Privacy Hint:<!-- --></strong> Note that the authentication path of each peer depends on the recent list of members (hence changes when new peers register or leave). As such, it is recommended (and necessary for privacy/anonymity) that the publisher updates her authentication path based on the latest status of the group and attempts the proof using the updated version.<!-- --></p>
<!-- --><p>An overview of the publishing procedure is provided in Figure 3.<!-- --></p>
<!-- --><h2><a class="anchor" id="routing"></a><a class="ha" href="#routing">Routing<!-- --></a></h2>
<!-- --><p>Upon the receipt of a message, the routing peer needs to decide whether to route it or not. This decision relies on the following factors:<!-- --></p>
<!-- --><ol>
<!-- --><li>If the epoch value attached to the message has a non-reasonable gap with the routing peer&#x27;s current epoch then the message must be dropped (this is to prevent a newly registered peer spamming the system by messaging for all the past epochs).<!-- --></li>
<!-- --><li>The message MUST contain valid proof that gets verified by the routing peer.
If the preceding checks are passed successfully, then the message is relayed. In case of an invalid proof, the message is dropped. If spamming is detected, the publishing peer gets slashed (see <!-- --><a href="/rln-relay#Spam-Detection-and-Slashing">Spam Detection and Slashing<!-- --></a>).<!-- --></li>
<!-- --></ol>
<!-- --><p>An overview of the routing procedure is provided in Figure 3.<!-- --></p>
<!-- --><h3><a class="anchor" id="spam-detection-and-slashing"></a><a class="ha" href="#spam-detection-and-slashing">Spam Detection and Slashing<!-- --></a></h3>
<!-- --><p>In order to enable local spam detection and slashing, routing peers MUST record the <!-- --><code>nullifier</code>, <!-- --><code>shareX</code>, and <!-- --><code>shareY</code> of any incoming message conditioned that it is not spam and has valid proof. To do so, the peer should follow the following steps.<!-- --></p>
<!-- --><ol>
<!-- --><li>The routing peer first verifies the <!-- --><code>zkProof</code> and drops the message if not verified.<!-- --></li>
<!-- --><li>Otherwise, it checks whether a message with an identical <!-- --><code>nullifier</code> has already been relayed.<!-- -->
<!-- --><ul>
<!-- --><li>a) If such message exists and its <!-- --><code>shareX</code> and <!-- --><code>shareY</code> components are different from the incoming message, then slashing takes place (if the <!-- --><code>shareX</code> and <!-- --><code>shareY</code> fields of the previously relayed message is identical to the incoming message, then the message is a duplicate and shall be dropped).<!-- --></li>
<!-- --><li>b) If none found, then the message gets relayed.<!-- --></li>
<!-- --></ul>
<!-- --></li>
<!-- --></ol>
<!-- --><figure class="rehype-figure"><img src="/compiled-assets/img/rln-relay/rln-message-verification.png" alt="Figure 3: Publishing, Routing and Slashing workflow."/><figcaption>Figure 3: Publishing, Routing and Slashing workflow.<!-- --></figcaption></figure>
<!-- --><h1><a class="anchor" id="feasibility-and-open-issues"></a><a class="ha" href="#feasibility-and-open-issues">Feasibility and Open Issues<!-- --></a></h1>
<!-- --><p>We&#x27;ve come a long way since a year ago, blockers resolved, now we have implemented it end-to-end. We learned lot and could identify further issues and unknowns some of which are blocking getting to production. The summary of the identified issues  are presented below.<!-- --></p>
<!-- --><h2><a class="anchor" id="storage-overhead-per-peer"></a><a class="ha" href="#storage-overhead-per-peer">Storage overhead per peer<!-- --></a></h2>
<!-- --><p>Currently, peers are supposed to maintain the entire tree locally and it imposes storage overhead which is linear in the size of the group (see this <!-- --><a href="https://github.com/vacp2p/research/issues/57">issue<!-- --></a><sup><a id="user-content-fnref-11" data-footnote-ref="true" aria-describedby="footnote-label" href="/rln-relay#user-content-fn-11">18<!-- --></a></sup> for more details). One way to cope with this is to use the light-node and full-node paradigm in which only a subset of peers who are more resourceful retain the tree whereas the light nodes obtain the necessary information by interacting with the full nodes. Another way to approach this problem is through a more storage efficient method (as described in this research issue<!-- --><sup><a id="user-content-fnref-12" data-footnote-ref="true" aria-describedby="footnote-label" href="/rln-relay#user-content-fn-12">19<!-- --></a></sup>) where peers store a partial view of the tree instead of the entire tree. Keeping the partial view lowers the storage complexity to O(log(N)) where N is the size of the group. There are still unknown unknowns to this solution, as such, it must be studied further to become fully functional.<!-- --></p>
<!-- --><h2><a class="anchor" id="cost-effective-way-of-member-insertion-and-deletion"></a><a class="ha" href="#cost-effective-way-of-member-insertion-and-deletion">Cost-effective way of member insertion and deletion<!-- --></a></h2>
<!-- --><p>Currently, the cost associated with RLN-Relay membership is around 30 USD<!-- --><sup><a id="user-content-fnref-10" data-footnote-ref="true" aria-describedby="footnote-label" href="/rln-relay#user-content-fn-10">20<!-- --></a></sup>. We aim at finding a more cost-effective approach. Please feel free to share with us your solution ideas in this regard in this <!-- --><a href="https://github.com/vacp2p/research/issues/56">issue<!-- --></a>.<!-- --></p>
<!-- --><h2><a class="anchor" id="exceeding-the-messaging-rate-via-multiple-registrations"></a><a class="ha" href="#exceeding-the-messaging-rate-via-multiple-registrations">Exceeding the messaging rate via multiple registrations<!-- --></a></h2>
<!-- --><p>While the economic-incentive solution has an economic incentive to discourage spamming, we should note that there is still <!-- --><strong>expensive attack(s)<!-- --></strong><sup><a id="user-content-fnref-23" data-footnote-ref="true" aria-describedby="footnote-label" href="/rln-relay#user-content-fn-23">21<!-- --></a></sup> that a spammer can launch to break the messaging rate limit. That is, the attacker can pay for multiple legit registrations e.g., k, hence being able to publish k messages per epoch. We believe that the higher the membership fee is, the less probable would be such an attack, hence a stronger level of spam-protection can be achieved. Following this argument, the high fee associated with the membership (which we listed above as an open problem) can indeed be contributing to a better protection level.<!-- --></p>
<!-- --><h1><a class="anchor" id="conclusion-and-future-steps"></a><a class="ha" href="#conclusion-and-future-steps">Conclusion and Future Steps<!-- --></a></h1>
<!-- --><p>As discussed in this post, Waku RLN Relay can achieve a privacy-preserving economic spam protection through rate-limiting nullifiers. The idea is to financially discourage peers from publishing more than one message per epoch. In specific, exceeding the messaging rate results in a financial charge. Those who violate this rule are called spammers and their messages are spam. The identification of spammers does not rely on any central entity. Also, the financial punishment of spammers is cryptographically guaranteed.
In this solution, privacy is guaranteed since: 1) Peers do not have to disclose any piece of personally identifiable information in any phase i.e., neither in the registration nor in the messaging phase 2) Peers can prove that they have not exceeded the messaging rate in a zero-knowledge manner and without leaving any trace to their membership accounts.
Furthermore, all the computations are light hence this solution fits the heterogenous p2p messaging system. Note that  the zero-knowledge proof parts are handled through zkSNARKs  and  the benchmarking result can be found in the RLN benchmark report<!-- --><sup><a id="user-content-fnref-5" data-footnote-ref="true" aria-describedby="footnote-label" href="/rln-relay#user-content-fn-5">22<!-- --></a></sup>.<!-- --></p>
<!-- --><p><strong>Future steps<!-- --></strong>:<!-- --></p>
<!-- --><p>We are still at the PoC level, and the development is in progress. As our future steps,<!-- --></p>
<!-- --><ul>
<!-- --><li>we would like to evaluate the running time associated with the Merkle tree operations. Indeed, the need to locally store Merkle tree on each peer was one of the unknowns discovered during this PoC and yet the concrete benchmarking result in this regard is not available.<!-- --></li>
<!-- --><li>We would also like to pursue our storage-efficient Merkle Tree maintenance solution in order to lower the storage overhead of peers.<!-- --></li>
<!-- --><li>In line with the storage optimization, the full-node light-node structure is another path to follow.<!-- --></li>
<!-- --><li>Another possible improvement is to replace the membership contract with a distributed group management scheme e.g., through distributed hash tables. This is to address possible performance issues that the interaction with the Ethereum blockchain may cause.  For example, the registration transactions are subject to delay as they have to be mined before being visible in the state of the membership contract. This means peers have to wait for some time before being able to publish any message.<!-- --></li>
<!-- --></ul>
<!-- --><h1><a class="anchor" id="acknowledgement"></a><a class="ha" href="#acknowledgement">Acknowledgement<!-- --></a></h1>
<!-- --><p>Thanks to Onur Kılıç for his explanation and pointers and for assisting with development and runtime issues. Also thanks to Barry Whitehat for his time and insightful comments. Special thanks to Oskar Thoren for his constructive comments and his guides during the development of this PoC and the writeup of this post.<!-- --></p>
<!-- --><h1><a class="anchor" id="references"></a><a class="ha" href="#references">References<!-- --></a></h1>
<!-- --><section data-footnotes="true" class="footnotes"><h2><a class="anchor" id="footnote-label"></a><a class="ha" href="#footnote-label">Footnotes<!-- --></a></h2>
<!-- --><ol>
<!-- --><li id="user-content-fn-2">
<!-- --><p>RLN-Relay specification: <!-- --><a href="https://rfc.vac.dev/spec/17/">https://rfc.vac.dev/spec/17/<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-2">↩<!-- --></a></p>
<!-- --></li>
<!-- --><li id="user-content-fn-3">
<!-- --><p>RLN documentation: <!-- --><a href="https://hackmd.io/tMTLMYmTR5eynw2lwK9n1w?both">https://hackmd.io/tMTLMYmTR5eynw2lwK9n1w?both<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-3">↩<!-- --></a></p>
<!-- --></li>
<!-- --><li id="user-content-fn-4">
<!-- --><p>RLN repositories: <!-- --><a href="https://github.com/kilic/RLN">https://github.com/kilic/RLN<!-- --></a> and <!-- --><a href="https://github.com/kilic/rlnapp">https://github.com/kilic/rlnapp<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-4">↩<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-4-2">↩<!-- --><sup>2<!-- --></sup></a></p>
<!-- --></li>
<!-- --><li id="user-content-fn-1">
<!-- --><p>Waku v2: <!-- --><a href="https://rfc.vac.dev/spec/10/">https://rfc.vac.dev/spec/10/<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-1">↩<!-- --></a></p>
<!-- --></li>
<!-- --><li id="user-content-fn-16">
<!-- --><p>GossipSub: <!-- --><a href="https://docs.libp2p.io/concepts/publish-subscribe/">https://docs.libp2p.io/concepts/publish-subscribe/<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-16">↩<!-- --></a></p>
<!-- --></li>
<!-- --><li id="user-content-fn-17">
<!-- --><p>Waku Relay: <!-- --><a href="https://rfc.vac.dev/spec/11/">https://rfc.vac.dev/spec/11/<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-17">↩<!-- --></a></p>
<!-- --></li>
<!-- --><li id="user-content-fn-8">
<!-- --><p>Proof of work: <!-- --><a href="http://www.infosecon.net/workshop/downloads/2004/pdf/clayton.pdf">http://www.infosecon.net/workshop/downloads/2004/pdf/clayton.pdf<!-- --></a> and <!-- --><a href="https://link.springer.com/content/pdf/10.1007/3-540-48071-4_10.pdf">https://link.springer.com/content/pdf/10.1007/3-540-48071-4_10.pdf<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-8">↩<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-8-2">↩<!-- --><sup>2<!-- --></sup></a></p>
<!-- --></li>
<!-- --><li id="user-content-fn-9">
<!-- --><p>EIP-627 Whisper: <!-- --><a href="https://eips.ethereum.org/EIPS/eip-627">https://eips.ethereum.org/EIPS/eip-627<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-9">↩<!-- --></a></p>
<!-- --></li>
<!-- --><li id="user-content-fn-6">
<!-- --><p>Peer Scoring: <!-- --><a href="https://github.com/libp2p/specs/blob/master/pubsub/gossipsub/gossipsub-v1.1.md#peer-scoring">https://github.com/libp2p/specs/blob/master/pubsub/gossipsub/gossipsub-v1.1.md#peer-scoring<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-6">↩<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-6-2">↩<!-- --><sup>2<!-- --></sup></a></p>
<!-- --></li>
<!-- --><li id="user-content-fn-7">
<!-- --><p>Peer scoring security issues: <!-- --><a href="https://github.com/vacp2p/research/issues/44">https://github.com/vacp2p/research/issues/44<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-7">↩<!-- --></a></p>
<!-- --></li>
<!-- --><li id="user-content-fn-14">
<!-- --><p>Zero Knowledge Proof: <!-- --><a href="https://dl.acm.org/doi/abs/10.1145/3335741.3335750">https://dl.acm.org/doi/abs/10.1145/3335741.3335750<!-- --></a> and <!-- --><a href="https://en.wikipedia.org/wiki/Zero-knowledge_proof">https://en.wikipedia.org/wiki/Zero-knowledge_proof<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-14">↩<!-- --></a></p>
<!-- --></li>
<!-- --><li id="user-content-fn-15">
<!-- --><p>zkSNARKs: <!-- --><a href="https://link.springer.com/chapter/10.1007/978-3-662-49896-5_11">https://link.springer.com/chapter/10.1007/978-3-662-49896-5_11<!-- --></a> and <!-- --><a href="https://coinpare.io/whitepaper/zcash.pdf">https://coinpare.io/whitepaper/zcash.pdf<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-15">↩<!-- --></a></p>
<!-- --></li>
<!-- --><li id="user-content-fn-13">
<!-- --><p>Shamir Secret Sharing Scheme: <!-- --><a href="https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing">https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-13">↩<!-- --></a></p>
<!-- --></li>
<!-- --><li id="user-content-fn-22">
<!-- --><p>zkSNARKs proof time: <!-- --><a href="https://github.com/vacp2p/research/issues/7">https://github.com/vacp2p/research/issues/7<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-22">↩<!-- --></a></p>
<!-- --></li>
<!-- --><li id="user-content-fn-21">
<!-- --><p>Prover key size: <!-- --><a href="https://github.com/vacp2p/research/issues/8">https://github.com/vacp2p/research/issues/8<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-21">↩<!-- --></a></p>
<!-- --></li>
<!-- --><li id="user-content-fn-19">
<!-- --><p>The lack of Shamir secret sharing in zkSNARKs: <!-- --><a href="https://github.com/vacp2p/research/issues/10">https://github.com/vacp2p/research/issues/10<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-19">↩<!-- --></a></p>
<!-- --></li>
<!-- --><li id="user-content-fn-20">
<!-- --><p>The MPC required for zkSNARKs trusted setup: <!-- --><a href="https://github.com/vacp2p/research/issues/9">https://github.com/vacp2p/research/issues/9<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-20">↩<!-- --></a></p>
<!-- --></li>
<!-- --><li id="user-content-fn-11">
<!-- --><p>Storage overhead per peer: <!-- --><a href="https://github.com/vacp2p/research/issues/57">https://github.com/vacp2p/research/issues/57<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-11">↩<!-- --></a></p>
<!-- --></li>
<!-- --><li id="user-content-fn-12">
<!-- --><p>Storage-efficient Merkle Tree maintenance: <!-- --><a href="https://github.com/vacp2p/research/pull/54">https://github.com/vacp2p/research/pull/54<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-12">↩<!-- --></a></p>
<!-- --></li>
<!-- --><li id="user-content-fn-10">
<!-- --><p>Cost-effective way of member insertion and deletion: <!-- --><a href="https://github.com/vacp2p/research/issues/56">https://github.com/vacp2p/research/issues/56<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-10">↩<!-- --></a></p>
<!-- --></li>
<!-- --><li id="user-content-fn-23">
<!-- --><p>Attack on the messaging rate: <!-- --><a href="https://github.com/vacp2p/specs/issues/251">https://github.com/vacp2p/specs/issues/251<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-23">↩<!-- --></a></p>
<!-- --></li>
<!-- --><li id="user-content-fn-5">
<!-- --><p>RLN Benchmark: <!-- --><a href="https://hackmd.io/tMTLMYmTR5eynw2lwK9n1w?view#Benchmarks">https://hackmd.io/tMTLMYmTR5eynw2lwK9n1w?view#Benchmarks<!-- --></a> <!-- --><a data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content" href="/rln-relay#user-content-fnref-5">↩<!-- --></a></p>
<!-- --></li>
<!-- --></ol>
<!-- --></section></article><aside class="Styles_container__3DqFl Style_toc__v7JJe Styles_common_toc__nMHyQ hidden-scroll"><nav class="Styles_tocComponent__fhPld hidden-scroll"><ul><li class="h-1"><a class="" href="/rln-relay#introduction">Introduction</a></li><li class="h-2"><a class="" href="/rln-relay#what-do-we-mean-by-spamming">What do we mean by spamming?</a></li><li class="h-2"><a class="" href="/rln-relay#possible-solutions">Possible Solutions</a></li><li class="h-3"><a class="" href="/rln-relay#centralized-messaging-systems">Centralized Messaging Systems</a></li><li class="h-3"><a class="" href="/rln-relay#p2p-systems">P2P Systems</a></li><li class="h-4"><a class="" href="/rln-relay#proof-of-work">Proof of work</a></li><li class="h-4"><a class="" href="/rln-relay#peer-scoring">Peer Scoring</a></li><li class="h-4"><a class="" href="/rln-relay#economic-incentive-spam-protection">Economic-Incentive Spam protection</a></li><li class="h-1"><a class="" href="/rln-relay#technical-terms">Technical Terms</a></li><li class="h-1"><a class="" href="/rln-relay#overview-economic-incentive-spam-protection-through-rate-limiting-nullifiers">Overview: Economic-Incentive Spam protection through Rate Limiting Nullifiers</a></li><li class="h-1"><a class="" href="/rln-relay#flow">Flow</a></li><li class="h-2"><a class="" href="/rln-relay#setup-and-registration">Setup and Registration</a></li><li class="h-2"><a class="" href="/rln-relay#maintaining-the-membership-merkle-tree">Maintaining the membership Merkle Tree</a></li><li class="h-2"><a class="" href="/rln-relay#publishing">Publishing</a></li><li class="h-2"><a class="" href="/rln-relay#routing">Routing</a></li><li class="h-3"><a class="" href="/rln-relay#spam-detection-and-slashing">Spam Detection and Slashing</a></li><li class="h-1"><a class="" href="/rln-relay#feasibility-and-open-issues">Feasibility and Open Issues</a></li><li class="h-2"><a class="" href="/rln-relay#storage-overhead-per-peer">Storage overhead per peer</a></li><li class="h-2"><a class="" href="/rln-relay#cost-effective-way-of-member-insertion-and-deletion">Cost-effective way of member insertion and deletion</a></li><li class="h-2"><a class="" href="/rln-relay#exceeding-the-messaging-rate-via-multiple-registrations">Exceeding the messaging rate via multiple registrations</a></li><li class="h-1"><a class="" href="/rln-relay#conclusion-and-future-steps">Conclusion and Future Steps</a></li><li class="h-1"><a class="" href="/rln-relay#acknowledgement">Acknowledgement</a></li><li class="h-1"><a class="" href="/rln-relay#references">References</a></li></ul></nav></aside></main><footer class="Styles_container___YkOC undefined Styles_common_footer__1rPoh"><div class="footer-content-container Styles_content__0jn9p"><div><p><span class="copy-left">©</span><span>2023<!-- --></span><span> Vac Research</span><span> - </span><span>Vac - Communication, Privacy, Etc</span></p></div><div class="Styles_bottomPart__CsMh_"><div class="Styles_socialMedia__AmAKz "><span><a href="https://twitter.com/vacp2p" class="button"><svg xmlns="http://www.w3.org/2000/svg" width="30" viewBox="0 0 543.684 543.684" xml:space="preserve"><path d="M527.657 106.697a231.362 231.362 0 0 1-8.041 2.191c-16.384 4.137-17.89-1.322-6.028-13.366a109.306 109.306 0 0 0 14.082-17.607c9.137-14.217 1.212-20.417-14.333-13.776a224.853 224.853 0 0 1-16.897 6.432c-16.017 5.379-38.746-2.735-53.018-11.787-18.018-11.426-38.495-17.136-61.438-17.136-32.137 0-59.529 11.334-82.192 33.984-22.656 22.662-33.99 50.062-33.99 82.191 0 4.394.251 8.855.747 13.378.814 7.362-11.585 12.699-28.317 10.336-36.194-5.11-70.582-16.077-103.171-32.889-32.32-16.671-60.845-37.65-85.57-62.938-11.819-12.086-27.804-11.045-32.217 5.27-2.644 9.78-3.959 19.951-3.959 30.515 0 19.908 4.675 38.372 14.027 55.392 4.651 8.47 10.098 16.138 16.353 22.999 10.521 11.549 8.911 18.25-5.734 14.144-14.639-4.106-25.367-10.202-25.367-9.804v.722c0 28.048 8.807 52.693 26.432 73.911 10.857 13.072 23.47 23.17 37.834 30.282 15.147 7.503 22.203 11.688 13.733 12.784-5.11.661-10.251.991-15.422.991-3.5 0-7.172-.159-11.003-.483-6.059-.514-7.148 12.111 2.038 26.298 7.301 11.273 16.646 21.193 28.03 29.762 11.579 8.721 24.058 14.981 37.417 18.794 16.255 4.633 19.517 13.073 5.024 21.763-35.863 21.519-75.551 32.277-119.058 32.277-4.902 0-9.578-.11-14.045-.324-7.754-.373-2.552 6.456 12.417 14.296 46.775 24.499 97.43 36.738 151.972 36.738 41.237 0 79.964-6.529 116.176-19.596 36.199-13.066 67.136-30.576 92.791-52.516 25.655-21.94 47.779-47.173 66.365-75.711 18.581-28.537 32.424-58.33 41.543-89.376 9.106-31.053 13.666-62.167 13.666-93.342 0-2.809-.024-5.331-.067-7.552-.086-4.174 10.955-15.472 23.28-27.032a242.397 242.397 0 0 0 15.937-16.444c11.179-12.688 6.228-18.502-9.997-13.771z"></path></svg></a></span><span><a href="https://discord.gg/PQFdubGt6d" class="button"><svg width="30" viewBox="0 0 71 55" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#discord_svg__a)"><path d="M60.105 4.898A58.55 58.55 0 0 0 45.653.415a.22.22 0 0 0-.233.11 40.784 40.784 0 0 0-1.8 3.697c-5.456-.817-10.886-.817-16.23 0-.485-1.164-1.201-2.587-1.828-3.697a.228.228 0 0 0-.233-.11 58.386 58.386 0 0 0-14.451 4.483.207.207 0 0 0-.095.082C1.578 18.73-.944 32.144.293 45.39a.244.244 0 0 0 .093.167c6.073 4.46 11.955 7.167 17.729 8.962a.23.23 0 0 0 .249-.082 42.08 42.08 0 0 0 3.627-5.9.225.225 0 0 0-.123-.312 38.772 38.772 0 0 1-5.539-2.64.228.228 0 0 1-.022-.378c.372-.279.744-.569 1.1-.862a.22.22 0 0 1 .23-.03c11.619 5.304 24.198 5.304 35.68 0a.219.219 0 0 1 .233.027c.356.293.728.586 1.103.865a.228.228 0 0 1-.02.378 36.384 36.384 0 0 1-5.54 2.637.227.227 0 0 0-.121.315 47.249 47.249 0 0 0 3.624 5.897.225.225 0 0 0 .249.084c5.801-1.794 11.684-4.502 17.757-8.961a.228.228 0 0 0 .092-.164c1.48-15.315-2.48-28.618-10.497-40.412a.18.18 0 0 0-.093-.084Zm-36.38 32.427c-3.497 0-6.38-3.211-6.38-7.156 0-3.944 2.827-7.156 6.38-7.156 3.583 0 6.438 3.24 6.382 7.156 0 3.945-2.827 7.156-6.381 7.156Zm23.593 0c-3.498 0-6.38-3.211-6.38-7.156 0-3.944 2.826-7.156 6.38-7.156 3.582 0 6.437 3.24 6.38 7.156 0 3.945-2.798 7.156-6.38 7.156Z" fill="#23272A"></path></g><defs><clipPath id="discord_svg__a"><path fill="#fff" d="M0 0h71v55H0z"></path></clipPath></defs></svg></a></span><span><a href="https://github.com/vacp2p" class="button"><svg width="30" viewBox="0 0 1024 1024" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M512 0C229.12 0 0 229.12 0 512c0 226.56 146.56 417.92 350.08 485.76 25.6 4.48 35.2-10.88 35.2-24.32 0-12.16-.64-52.48-.64-95.36-128.64 23.68-161.92-31.36-172.16-60.16-5.76-14.72-30.72-60.16-52.48-72.32-17.92-9.6-43.52-33.28-.64-33.92 40.32-.64 69.12 37.12 78.72 52.48 46.08 77.44 119.68 55.68 149.12 42.24 4.48-33.28 17.92-55.68 32.64-68.48-113.92-12.8-232.96-56.96-232.96-252.8 0-55.68 19.84-101.76 52.48-137.6-5.12-12.8-23.04-65.28 5.12-135.68 0 0 42.88-13.44 140.8 52.48 40.96-11.52 84.48-17.28 128-17.28 43.52 0 87.04 5.76 128 17.28 97.92-66.56 140.8-52.48 140.8-52.48 28.16 70.4 10.24 122.88 5.12 135.68 32.64 35.84 52.48 81.28 52.48 137.6 0 196.48-119.68 240-233.6 252.8 18.56 16 34.56 46.72 34.56 94.72 0 68.48-.64 123.52-.64 140.8 0 13.44 9.6 29.44 35.2 24.32C877.44 929.92 1024 737.92 1024 512 1024 229.12 794.88 0 512 0Z" fill="#1B1F23"></path></svg></a></span></div><nav class="Styles_legal__0ciDG"><a title="Privacy Policy" href="/privacy-policy">Privacy Policy</a></nav></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"markdown":{"content":"# Introduction\nThis post is going to give you an overview of how spam protection can be achieved in Waku Relay protocol[^2] through Rate-Limiting Nullifiers[^3] [^4] or RLN for short.\n\nLet me give a little background about Waku(v2)[^1]. Waku is a privacy-preserving peer-to-peer (p2p) messaging protocol for resource-restricted devices. Being p2p means that Waku relies on **No** central server. Instead, peers collaboratively deliver messages in the network. Waku uses GossipSub[^16] as the underlying routing protocol (as of the writeup of this post). At a high level, GossipSub is based on publisher-subscriber architecture. That is, *peers, congregate around topics they are interested in and can send messages to topics. Each message gets delivered to all peers subscribed to the topic*. In GossipSub, a peer has a constant number of direct connections/neighbors. In order to publish a message, the author forwards its message to a subset of neighbors. The neighbors proceed similarly till the message gets propagated in the network of the subscribed peers. The message publishing and routing procedures are part of the Waku Relay[^17] protocol.\n![Figure 1: An overview of privacy-preserving p2p economic spam protection in Waku v2 RLN-Relay protocol.](/img/rln-relay/rln-relay-overview.png)\n\n## What do we mean by spamming?\nIn centralized messaging systems, a spammer usually indicates an entity that uses the messaging system to send an unsolicited message (spam) to large numbers of recipients. However, in Waku with a p2p architecture, spam messages not only affect the recipients but also all the other peers involved in the routing process as they have to spend their computational power/bandwidth/storage capacity on processing spam messages. As such, we define a spammer as an entity that uses the messaging system to publish a large number of messages in a short amount of time. The messages issued in this way are called spam. In this definition, we disregard the intention of the spammer as well as the content of the message and the number of recipients.\n\n## Possible Solutions\nHas the spamming issue been addressed before? Of course yes! Here is an overview of the spam protection techniques with their trade-offs and use-cases. In this overview, we distinguish between protection techniques that are targeted for centralized messaging systems and those for p2p architectures.\n\n### Centralized Messaging Systems\nIn traditional centralized messaging systems, spam usually signifies unsolicited messages sent in bulk or messages with malicious content like malware. Protection mechanisms include \n- authentication through some piece of personally identifiable information e.g., phone number\n- checksum-based filtering to protect against messages sent in bulk\n- challenge-response systems\n- content filtering on the server or via a proxy application\n\nThese methods exploit the fact that the messaging system is centralized and a global view of the users' activities is available based on which spamming patterns can be extracted and defeated accordingly.  Moreover, users are associated with an identifier e.g., a username which enables the server to profile each user e.g., to detect suspicious behavior like spamming. Such profiling possibility is against the user's anonymity and privacy. \n\nAmong the techniques enumerated above, authentication through phone numbers is a some-what economic-incentive measure as providing multiple valid phone numbers will be expensive for the attacker. Notice that while using an expensive authentication method can reduce the number of accounts owned by a single spammer, cannot address the spam issue entirely. This is because the spammer can still send bulk messages through one single account. For this approach to be effective, a centralized mediator is essential. That is why such a solution would not fit the p2p environments where no centralized control exists.\n\n### P2P Systems\nWhat about spam prevention in p2p messaging platforms? There are two techniques, namely *Proof of Work*[^8]  deployed by Whisper[^9] and *Peer scoring*[^6] method (namely reputation-based approach) adopted by LibP2P. However, each of these solutions has its own shortcomings for real-life use-cases as explained below. \n\n#### Proof of work\nThe idea behind the Proof Of Work i.e., POW[^8] is to make messaging a computationally costly operation hence lowering the messaging rate of **all** the peers including the spammers. In specific, the message publisher has to solve a puzzle and the puzzle is to find a nonce such that the hash of the message concatenated with the nonce has at least z leading zeros. z is known as the difficulty of the puzzle. Since the hash function is one-way, peers have to brute-force to find a nonce. Hashing is a computationally-heavy operation so is the brute-force. While solving the puzzle is computationally expensive, it is comparatively cheap to verify the solution.\n\nPOW is also used as the underlying mining algorithm in Ethereum and Bitcoin blockchain. There, the goal is to contain the mining speed and allow the decentralized network to come to a consensus, or agree on things like account balances and the order of transactions. \n\nWhile the use of POW makes perfect sense in Ethereum / Bitcoin blockchain, it shows practical issues in heterogeneous p2p messaging systems with resource-restricted peers. Some peers won't be able to carry the designated computation and will be effectively excluded. Such exclusion showed to be practically an issue in applications like Status, which used to rely on POW for spam-protection, to the extent that the difficulty level had to be set close to zero. \n\n#### Peer Scoring\nThe peer scoring method[^6] that is utilized by libp2p is to limit the number of messages issued by a peer in connection to another peer. That is each peer monitors all the peers to which it is directly connected and adjusts their messaging quota i.e., to route or not route their messages depending on their past activities. For example, if a peer detects its neighbor is sending more than x messages per month, can drop its quota to z.x where z is less than one.  The shortcoming of this solution is that scoring is based on peers' local observations and the concept of the score is defined in relation to one single peer. This leaves room for an attack where a spammer can make connections to k peers in the system and publishes k.(x-1)  messages by exploiting all of its k connections. Another attack scenario is through botnets consisting of a large number of e.g., a million bots. The attacker rents a botnet and inserts each of them as a legitimate peer to the network and each can publish x-1 messages per month[^7].\n\n#### Economic-Incentive Spam protection\nIs this the end of our spam-protection journey? Shall we simply give up and leave spammers be? Certainly not!\nWaku RLN-Relay gives us a p2p spam-protection method which:\n- suits **p2p** systems and does not rely on any central entity.\n- is **efficient**  i.e., with no unreasonable computational, storage, memory, and bandwidth requirement! as such, it fits the network of **heterogeneous** peers. \n- respects users **privacy** unlike reputation-based and centralized methods.\n- deploys **economic-incentives** to contain spammers' activity. Namely, there is a financial sacrifice for those who want to spam the system. How? follow along ...\n\nWe devise a general rule to save everyone's life and that is \n\n**No one can publish more than M messages per epoch without being financially charged!** \n\nWe set M to 1 for now, but this can be any arbitrary value. You may be thinking \"This is too restrictive! Only one per epoch?\". Don't worry, we set the epoch to a reasonable value so that it does not slow down the communication of innocent users but will make the life of spammers harder! Epoch here can be every second, as defined by UTC date-time +-20s.\n\nThe remainder of this post is all about the story of how to enforce this limit on each user's messaging rate as well as how to impose the financial cost when the limit gets violated.  This brings us to the Rate Limiting Nullifiers and how we integrate this technique into Waku v2 (in specific the Waku Relay protocol) to protect our valuable users against spammers.\n\n# Technical Terms\n**Zero-knowledge proof**: Zero-knowledge proof (ZKP)[^14] allows a *prover* to show a *verifier* that they know something, without revealing what that something is. This means you can do the trust-minimized computation that is also privacy-preserving. As a basic example, instead of showing your ID when going to a bar you simply give them proof that you are over 18, without showing the doorman your id. In this write-up, by ZKP we essentially mean zkSNARK[^15] which is one of the many types of ZKPs. \n\n**Threshold Secret Sharing Scheme**: (m,n) Threshold secret-sharing is a method by which you can split a secret value s into n pieces in a way that the secret s can be reconstructed by having m pieces (m \u003c= n). The economic-incentive spam protection utilizes a (2,n) secret sharing realized by Shamir Secret Sharing Scheme[^13].\n\n# Overview: Economic-Incentive Spam protection through Rate Limiting Nullifiers\n**Context**: We started the idea of economic-incentive spam protection more than a year ago and conducted a feasibility study to identify blockers and unknowns. The results are published in our prior [post](https://vac.dev/feasibility-semaphore-rate-limiting-zksnarks). Since then major progress has been made and the prior identified blockers that are listed below are now addressed. Kudos to [Barry WhiteHat](https://github.com/barryWhiteHat), [Onur Kilic](https://github.com/kilic), [Koh Wei Jie](https://github.com/weijiekoh/perpetualpowersoftau) for all of their hard work, research, and development which made this progress possible.\n- the proof time[^22] which was initially in the order of minutes ~10 mins and now is almost 0.5 seconds\n- the prover key size[^21] which was initially ~110MB and now is ~3.9MB\n- the lack of Shamir logic[^19] which is now implemented and part of the RLN repository[^4]\n- the concern regarding the potential multi-party computation for the trusted setup of zkSNARKs which got resolved[^20]\n- the lack of end-to-end integration that now we made it possible, have it implemented, and are going to present it in this post. New blockers are also sorted out during the e2e integration which we will discuss in the [Feasibility and Open Issues](#feasibility-and-open-issues) section.\n\nNow that you have more context, let's see how the final solution works. The fundamental point is to make it economically costly to send more than your share of messages and to do so in a privacy-preserving and e2e fashion. To do that we have the following components:\n\n- 1- **Group**: We manage all the peers inside a large group (later we can split peers into smaller groups, but for now consider only one). The group management is done via a smart contract which is devised for this purpose and is deployed on the Ethereum blockchain.\n- 2- **Membership**: To be able to send messages and in specific for the published messages to get routed by all the peers, publishing peers have to register to the group. Membership involves setting up public and private key pairs (think of it as the username and password). The private key remains at the user side but the public key becomes a part of the group information on the contract (publicly available) and everyone has access to it. Public keys are not human-generated (like usernames) and instead they are random numbers, as such, they do not reveal any information about the owner (think of public keys as pseudonyms). Registration is mandatory for the users who want to publish a message, however, users who only want to listen to the messages are more than welcome and do not have to register in the group. \n- **Membership fee**: Membership is not for free! each peer has to lock a certain amount of funds during the registration (this means peers have to have an Ethereum account with sufficient balance for this sake). This fund is safely stored on the contract and remains intact unless the peer attempts to break the rules and publish more than one message per epoch. \n- **Zero-knowledge Proof of membership**: Do you want your message to get routed to its destination, fine, but you have to prove that you are a member of the group (sorry, no one can escape the registration phase!). Now, you may be thinking that should I attach my public key to my message to prove my membership? Absolutely Not! we said that our solution respects privacy! membership proofs are done in a zero-knowledge manner that is each message will carry cryptographic proof asserting that \"the message is generated by one of the current members of the group\", so your identity remains private and your anonymity is preserved!\n- **Slashing through secret sharing**: Till now it does not seem like we can catch spammers, right? yes, you are right! now comes the exciting part, detecting spammers and slashing them. The core idea behind the slashing is that each publishing peer (not routing peers!) has to integrate a secret share of its private key inside the message. The secret share is deterministically computed over the private key and the current epoch. The content of this share is harmless for the peer's privacy (it looks random) unless the peer attempts to publish more than one message in the same epoch hence disclosing more than one secret share of its private key. Indeed two distinct shares of the private key under the same epoch are enough to reconstruct the entire private key. Then what should you do with the recovered private key? hurry up! go to the contract and withdraw the private key and claim its fund and get rich!! Are you thinking what if spammers attach junk values instead of valid secret shares? Of course, that wouldn't be cool! so, there is a zero-knowledge proof for this sake as well where the publishing peer has to prove that the secret shares are generated correctly.\n\nA high-level overview of the economic spam protection is shown in Figure 1.\n\n# Flow \nIn this section, we describe the flow of the economic-incentive spam detection mechanism from the viewpoint of a single peer. An overview of this flow is provided in Figure 3.\n\n## Setup and Registration\nA peer willing to publish a message is required to register. Registration is moderated through a smart contract deployed on the Ethereum blockchain. The state of the contract contains the list of registered members' public keys. An overview of registration is illustrated in Figure 2.\n\nFor the registration, a peer creates a transaction that sends x amount of Ether to the contract. The peer who has the \"private key\" `sk` associated with that deposit would be able to withdraw x Ether by providing valid proof. Note that  `sk` is initially only known by the owning peer however it may get exposed to other peers in case the owner attempts spamming the system i.e., sending more than one message per epoch.\nThe following relation holds between the `sk` and `pk` i.e., `pk = H(sk)` where `H` denotes a hash function.\n![Figure 2: Registration](/img/rln-relay/rln-relay.png)\n\n## Maintaining the membership Merkle Tree\nThe ZKP of membership that we mentioned before relies on the representation of the entire group as a [Merkle Tree](). The tree construction and maintenance is delegated to the peers (the initial idea was to keep the tree on the chain as part of the contract, however, the cost associated with member deletion and insertion was high and unreasonable, please see [Feasibility and Open Issues](#Feasibility-and-Open-Issues) for more details). As such, each peer needs to build the tree locally and sync itself with the contract updates (peer insertion and deletion) to mirror them on its tree.\nTwo pieces of information of the tree are important as they enable peers to generate zero-knowledge proofs. One is the root of the tree and the other is the membership proof (or the authentication path). The tree root is public information whereas the membership proof is private data (or more precisely the index of the peer in the tree). \n\n## Publishing\nIn order to publish at a given epoch, each message must carry a proof i.e., a zero-knowledge proof signifying that the publishing peer is a  registered member, and has not exceeded the messaging rate at the given epoch. \n\nRecall that the enforcement of the messaging rate was through associating a secret shared version of the peer's `sk` into the message together with a ZKP that the secret shares are constructed correctly. As for the secret sharing part, the peer generates the following data:\n1. `shareX`\n2. `shareY`\n3. `nullifier`\n\nThe pair (`shareX`, `shareY`)  is the secret shared version of `sk` that are generated using Shamir secret sharing scheme. Having two such pairs for an identical `nullifier` results in full disclosure of peer's `sk` and hence burning the associated deposit. Note that the `nullifier` is a deterministic value derived from `sk` and `epoch` therefore any two messages issued by the same peer (i.e., using the same `sk`) for the same `epoch` are guaranteed to have identical `nullifier`s.\n\nFinally, the peer generates a zero-knowledge proof  `zkProof`  asserting the membership of the peer in the group and the correctness of the attached secret share (`shareX`, `shareY`) and the `nullifier`. In order to generate a valid proof, the peer needs to have two private inputs i.e., its `sk` and its authentication path. Other inputs are the tree root, epoch, and the content of the message.\n\n**Privacy Hint:** Note that the authentication path of each peer depends on the recent list of members (hence changes when new peers register or leave). As such, it is recommended (and necessary for privacy/anonymity) that the publisher updates her authentication path based on the latest status of the group and attempts the proof using the updated version.\n\nAn overview of the publishing procedure is provided in Figure 3.\n\n## Routing\nUpon the receipt of a message, the routing peer needs to decide whether to route it or not. This decision relies on the following factors:\n1) If the epoch value attached to the message has a non-reasonable gap with the routing peer's current epoch then the message must be dropped (this is to prevent a newly registered peer spamming the system by messaging for all the past epochs). \n2) The message MUST contain valid proof that gets verified by the routing peer. \nIf the preceding checks are passed successfully, then the message is relayed. In case of an invalid proof, the message is dropped. If spamming is detected, the publishing peer gets slashed (see [Spam Detection and Slashing](#Spam-Detection-and-Slashing)). \n\nAn overview of the routing procedure is provided in Figure 3.\n\n### Spam Detection and Slashing\nIn order to enable local spam detection and slashing, routing peers MUST record the `nullifier`, `shareX`, and `shareY` of any incoming message conditioned that it is not spam and has valid proof. To do so, the peer should follow the following steps. \n1. The routing peer first verifies the `zkProof` and drops the message if not verified. \n2. Otherwise, it checks whether a message with an identical `nullifier` has already been relayed. \n   + a) If such message exists and its `shareX` and `shareY` components are different from the incoming message, then slashing takes place (if the `shareX` and `shareY` fields of the previously relayed message is identical to the incoming message, then the message is a duplicate and shall be dropped).\n   + b) If none found, then the message gets relayed.\n\nAn overview of the slashing procedure is provided in Figure 3.\n![Figure 3: Publishing, Routing and Slashing workflow.](/img/rln-relay/rln-message-verification.png)\n\n# Feasibility and Open Issues\nWe've come a long way since a year ago, blockers resolved, now we have implemented it end-to-end. We learned lot and could identify further issues and unknowns some of which are blocking getting to production. The summary of the identified issues  are presented below.\n\n## Storage overhead per peer\nCurrently, peers are supposed to maintain the entire tree locally and it imposes storage overhead which is linear in the size of the group (see this [issue](https://github.com/vacp2p/research/issues/57)[^11] for more details). One way to cope with this is to use the light-node and full-node paradigm in which only a subset of peers who are more resourceful retain the tree whereas the light nodes obtain the necessary information by interacting with the full nodes. Another way to approach this problem is through a more storage efficient method (as described in this research issue[^12]) where peers store a partial view of the tree instead of the entire tree. Keeping the partial view lowers the storage complexity to O(log(N)) where N is the size of the group. There are still unknown unknowns to this solution, as such, it must be studied further to become fully functional.\n\n## Cost-effective way of member insertion and deletion\nCurrently, the cost associated with RLN-Relay membership is around 30 USD[^10]. We aim at finding a more cost-effective approach. Please feel free to share with us your solution ideas in this regard in this [issue](https://github.com/vacp2p/research/issues/56). \n\n## Exceeding the messaging rate via multiple registrations\nWhile the economic-incentive solution has an economic incentive to discourage spamming, we should note that there is still **expensive attack(s)**[^23] that a spammer can launch to break the messaging rate limit. That is, the attacker can pay for multiple legit registrations e.g., k, hence being able to publish k messages per epoch. We believe that the higher the membership fee is, the less probable would be such an attack, hence a stronger level of spam-protection can be achieved. Following this argument, the high fee associated with the membership (which we listed above as an open problem) can indeed be contributing to a better protection level.  \n\n# Conclusion and Future Steps\nAs discussed in this post, Waku RLN Relay can achieve a privacy-preserving economic spam protection through rate-limiting nullifiers. The idea is to financially discourage peers from publishing more than one message per epoch. In specific, exceeding the messaging rate results in a financial charge. Those who violate this rule are called spammers and their messages are spam. The identification of spammers does not rely on any central entity. Also, the financial punishment of spammers is cryptographically guaranteed. \nIn this solution, privacy is guaranteed since: 1) Peers do not have to disclose any piece of personally identifiable information in any phase i.e., neither in the registration nor in the messaging phase 2) Peers can prove that they have not exceeded the messaging rate in a zero-knowledge manner and without leaving any trace to their membership accounts. \nFurthermore, all the computations are light hence this solution fits the heterogenous p2p messaging system. Note that  the zero-knowledge proof parts are handled through zkSNARKs  and  the benchmarking result can be found in the RLN benchmark report[^5].\n\n**Future steps**:\n\nWe are still at the PoC level, and the development is in progress. As our future steps, \n- we would like to evaluate the running time associated with the Merkle tree operations. Indeed, the need to locally store Merkle tree on each peer was one of the unknowns discovered during this PoC and yet the concrete benchmarking result in this regard is not available. \n- We would also like to pursue our storage-efficient Merkle Tree maintenance solution in order to lower the storage overhead of peers. \n- In line with the storage optimization, the full-node light-node structure is another path to follow. \n- Another possible improvement is to replace the membership contract with a distributed group management scheme e.g., through distributed hash tables. This is to address possible performance issues that the interaction with the Ethereum blockchain may cause.  For example, the registration transactions are subject to delay as they have to be mined before being visible in the state of the membership contract. This means peers have to wait for some time before being able to publish any message. \n\n# Acknowledgement\nThanks to Onur Kılıç for his explanation and pointers and for assisting with development and runtime issues. Also thanks to Barry Whitehat for his time and insightful comments. Special thanks to Oskar Thoren for his constructive comments and his guides during the development of this PoC and the writeup of this post.\n\n# References\n\n[^1]: Waku v2: https://rfc.vac.dev/spec/10/\n[^2]: RLN-Relay specification: https://rfc.vac.dev/spec/17/\n[^3]: RLN documentation: [https://hackmd.io/tMTLMYmTR5eynw2lwK9n1w?both](https://hackmd.io/tMTLMYmTR5eynw2lwK9n1w?both)\n[^4]: RLN repositories: [https://github.com/kilic/RLN](https://github.com/kilic/RLN) and [https://github.com/kilic/rlnapp](https://github.com/kilic/rlnapp)\n[^5]: RLN Benchmark: [https://hackmd.io/tMTLMYmTR5eynw2lwK9n1w?view#Benchmarks](https://hackmd.io/tMTLMYmTR5eynw2lwK9n1w?view#Benchmarks)\n[^6]: Peer Scoring: [https://github.com/libp2p/specs/blob/master/pubsub/gossipsub/gossipsub-v1.1.md#peer-scoring](https://github.com/libp2p/specs/blob/master/pubsub/gossipsub/gossipsub-v1.1.md#peer-scoring)\n[^7]: Peer scoring security issues: [https://github.com/vacp2p/research/issues/44](https://github.com/vacp2p/research/issues/44)\n[^8]: Proof of work: [http://www.infosecon.net/workshop/downloads/2004/pdf/clayton.pdf](http://www.infosecon.net/workshop/downloads/2004/pdf/clayton.pdf) and [https://link.springer.com/content/pdf/10.1007/3-540-48071-4_10.pdf](https://link.springer.com/content/pdf/10.1007/3-540-48071-4_10.pdf)\n[^9]: EIP-627 Whisper: https://eips.ethereum.org/EIPS/eip-627\n[^10]: Cost-effective way of member insertion and deletion: [https://github.com/vacp2p/research/issues/56](https://github.com/vacp2p/research/issues/56)\n[^11]: Storage overhead per peer: [https://github.com/vacp2p/research/issues/57](https://github.com/vacp2p/research/issues/57)\n[^12]: Storage-efficient Merkle Tree maintenance: [https://github.com/vacp2p/research/pull/54](https://github.com/vacp2p/research/pull/54)\n[^13]: Shamir Secret Sharing Scheme: [https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing](https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing)\n[^14]: Zero Knowledge Proof: [https://dl.acm.org/doi/abs/10.1145/3335741.3335750](https://dl.acm.org/doi/abs/10.1145/3335741.3335750) and [https://en.wikipedia.org/wiki/Zero-knowledge_proof](https://en.wikipedia.org/wiki/Zero-knowledge_proof)\n[^15]: zkSNARKs: [https://link.springer.com/chapter/10.1007/978-3-662-49896-5_11](https://link.springer.com/chapter/10.1007/978-3-662-49896-5_11) and [https://coinpare.io/whitepaper/zcash.pdf](https://coinpare.io/whitepaper/zcash.pdf)\n[^16]: GossipSub: [https://docs.libp2p.io/concepts/publish-subscribe/](https://docs.libp2p.io/concepts/publish-subscribe/) \n[^17]: Waku Relay: https://rfc.vac.dev/spec/11/\n[^18]: Prior blockers of RLN-Relay: [https://vac.dev/feasibility-semaphore-rate-limiting-zksnarks](https://vac.dev/feasibility-semaphore-rate-limiting-zksnarks) \n[^19]: The lack of Shamir secret sharing in zkSNARKs: [https://github.com/vacp2p/research/issues/10](https://github.com/vacp2p/research/issues/10)\n[^20]: The MPC required for zkSNARKs trusted setup: [https://github.com/vacp2p/research/issues/9](https://github.com/vacp2p/research/issues/9)\n[^21]: Prover key size: [https://github.com/vacp2p/research/issues/8](https://github.com/vacp2p/research/issues/8)\n[^22]: zkSNARKs proof time: [https://github.com/vacp2p/research/issues/7](https://github.com/vacp2p/research/issues/7)\n[^23]: Attack on the messaging rate: [https://github.com/vacp2p/specs/issues/251](https://github.com/vacp2p/specs/issues/251)\n","metadata":{"layout":"post","name":"Privacy-preserving p2p economic spam protection in Waku v2","title":"Privacy-preserving p2p economic spam protection in Waku v2","date":"2021-03-05T12:00:00.000Z","author":"sanaztaheri","published":true,"permalink":"/rln-relay","categories":"research","summary":"This post is going to give you an overview of how spam protection can be achieved in Waku Relay through rate-limiting nullifiers. We will cover a summary of spam-protection methods in centralized and p2p systems, and the solution overview and details of the economic spam-protection method. The open issues and future steps are discussed in the end.","image":"/img/rain.png","discuss":"https://forum.vac.dev/t/privacy-preserving-p2p-economic-spam-protection-in-waku-v2-with-rate-limiting-nullfiers/66"},"toc":[{"content":"Introduction","slug":"introduction","lvl":1,"i":0,"seen":0},{"content":"What do we mean by spamming?","slug":"what-do-we-mean-by-spamming","lvl":2,"i":1,"seen":0},{"content":"Possible Solutions","slug":"possible-solutions","lvl":2,"i":2,"seen":0},{"content":"Centralized Messaging Systems","slug":"centralized-messaging-systems","lvl":3,"i":3,"seen":0},{"content":"P2P Systems","slug":"p2p-systems","lvl":3,"i":4,"seen":0},{"content":"Proof of work","slug":"proof-of-work","lvl":4,"i":5,"seen":0},{"content":"Peer Scoring","slug":"peer-scoring","lvl":4,"i":6,"seen":0},{"content":"Economic-Incentive Spam protection","slug":"economic-incentive-spam-protection","lvl":4,"i":7,"seen":0},{"content":"Technical Terms","slug":"technical-terms","lvl":1,"i":8,"seen":0},{"content":"Overview: Economic-Incentive Spam protection through Rate Limiting Nullifiers","slug":"overview-economic-incentive-spam-protection-through-rate-limiting-nullifiers","lvl":1,"i":9,"seen":0},{"content":"Flow","slug":"flow","lvl":1,"i":10,"seen":0},{"content":"Setup and Registration","slug":"setup-and-registration","lvl":2,"i":11,"seen":0},{"content":"Maintaining the membership Merkle Tree","slug":"maintaining-the-membership-merkle-tree","lvl":2,"i":12,"seen":0},{"content":"Publishing","slug":"publishing","lvl":2,"i":13,"seen":0},{"content":"Routing","slug":"routing","lvl":2,"i":14,"seen":0},{"content":"Spam Detection and Slashing","slug":"spam-detection-and-slashing","lvl":3,"i":15,"seen":0},{"content":"Feasibility and Open Issues","slug":"feasibility-and-open-issues","lvl":1,"i":16,"seen":0},{"content":"Storage overhead per peer","slug":"storage-overhead-per-peer","lvl":2,"i":17,"seen":0},{"content":"Cost-effective way of member insertion and deletion","slug":"cost-effective-way-of-member-insertion-and-deletion","lvl":2,"i":18,"seen":0},{"content":"Exceeding the messaging rate via multiple registrations","slug":"exceeding-the-messaging-rate-via-multiple-registrations","lvl":2,"i":19,"seen":0},{"content":"Conclusion and Future Steps","slug":"conclusion-and-future-steps","lvl":1,"i":20,"seen":0},{"content":"Acknowledgement","slug":"acknowledgement","lvl":1,"i":21,"seen":0},{"content":"References","slug":"references","lvl":1,"i":22,"seen":0}]},"navProps":{"metadata":{"published":true,"title":"Privacy-preserving p2p economic spam protection in Waku v2","layout":"post","name":"Privacy-preserving p2p economic spam protection in Waku v2","date":"2021-03-05T12:00:00.000Z","author":"sanaztaheri","permalink":"/rln-relay","categories":"research","summary":"This post is going to give you an overview of how spam protection can be achieved in Waku Relay through rate-limiting nullifiers. We will cover a summary of spam-protection methods in centralized and p2p systems, and the solution overview and details of the economic spam-protection method. The open issues and future steps are discussed in the end.","image":"img/rain.png","discuss":"https://forum.vac.dev/t/privacy-preserving-p2p-economic-spam-protection-in-waku-v2-with-rate-limiting-nullfiers/66"},"navOrder":1614945600,"localPath":"research/2021-03-03-rln-relay.md","path":["rln-relay"],"children":[],"isDir":false},"routeParams":{"path":["rln-relay"]}},"__N_SSG":true},"page":"/[[...path]]","query":{"path":["rln-relay"]},"buildId":"ulkdS6VOmlR0pndRpqll2","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>