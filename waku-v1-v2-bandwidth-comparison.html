<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Waku v1 vs Waku v2: Bandwidth Comparison</title><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="description" content="A local comparison of bandwidth profiles showing significantly improved scalability in Waku v2 over Waku v1."/><link rel="shortcut icon" href="/assets/logo/vac/favicon.ico"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:creator" content="vacp2p"/><meta name="twitter:site" content="@vacp2p"/><meta name="twitter:title" content="Waku v1 vs Waku v2: Bandwidth Comparison"/><meta name="twitter:description" content="A local comparison of bandwidth profiles showing significantly improved scalability in Waku v2 over Waku v1."/><meta name="twitter:image" content="https://staging.vac.dev/compiled-assets/img/waku1-vs-waku2/waku1-vs-waku2-overall-network-size.png"/><meta property="og:url" content="https://staging.vac.dev//waku-v1-v2-bandwidth-comparison"/><meta property="og:image" content="https://staging.vac.dev/compiled-assets/img/waku1-vs-waku2/waku1-vs-waku2-overall-network-size.png"/><meta property="og:site_name" content="Waku v1 vs Waku v2: Bandwidth Comparison"/><meta property="og:title" content="Waku v1 vs Waku v2: Bandwidth Comparison"/><meta property="og:description" content="A local comparison of bandwidth profiles showing significantly improved scalability in Waku v2 over Waku v1."/><meta name="next-head-count" content="16"/><link rel="preload" href="/_next/static/css/e068b41030ceede6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e068b41030ceede6.css" data-n-g=""/><link rel="preload" href="/_next/static/css/cdd95df0746869ac.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cdd95df0746869ac.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-a14325fd952bf0eb.js" defer=""></script><script src="/_next/static/chunks/framework-fc97f3f1282ce3ed.js" defer=""></script><script src="/_next/static/chunks/main-ada0258e433ba222.js" defer=""></script><script src="/_next/static/chunks/pages/_app-778611497b5d3bb8.js" defer=""></script><script src="/_next/static/chunks/eb1842f2-90eb16656390ba2a.js" defer=""></script><script src="/_next/static/chunks/399-b4b9981c243e7c94.js" defer=""></script><script src="/_next/static/chunks/22-8cff067eee1338f6.js" defer=""></script><script src="/_next/static/chunks/pages/%5B%5B...path%5D%5D-e5cc32395b198f36.js" defer=""></script><script src="/_next/static/8KpGkiJW7RjczljzY8he_/_buildManifest.js" defer=""></script><script src="/_next/static/8KpGkiJW7RjczljzY8he_/_ssgManifest.js" defer=""></script><script src="/_next/static/8KpGkiJW7RjczljzY8he_/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><svg width="0" height="0" xmlns="http://www.w3.org/2000/svg" style="display:none"><defs><filter id="colored"><feColorMatrix type="matrix" values="1.00 0 0 0 0 0 1.00 0 0 0 0 0 1.00 0 0 0 0 0 1 0"></feColorMatrix></filter></defs></svg><style nonce="logos">
      #nprogress {
        pointer-events: none;
      }
      #nprogress .bar {
        background: #000000;
        position: fixed;
        z-index: 9999;
        top: 0;
        left: 0;
        width: 100%;
        height: 3px;
      }
      #nprogress .peg {
        display: block;
        position: absolute;
        right: 0px;
        width: 100px;
        height: 100%;
        box-shadow: 0 0 10px #000000, 0 0 5px #000000;
        opacity: 1;
        -webkit-transform: rotate(3deg) translate(0px, -4px);
        -ms-transform: rotate(3deg) translate(0px, -4px);
        transform: rotate(3deg) translate(0px, -4px);
      }
      #nprogress .spinner {
        display: block;
        position: fixed;
        z-index: 1031;
        top: 15px;
        right: 15px;
      }
      #nprogress .spinner-icon {
        width: 18px;
        height: 18px;
        box-sizing: border-box;
        border: solid 2px transparent;
        border-top-color: #000000;
        border-left-color: #000000;
        border-radius: 50%;
        -webkit-animation: nprogresss-spinner 400ms linear infinite;
        animation: nprogress-spinner 400ms linear infinite;
      }
      .nprogress-custom-parent {
        overflow: hidden;
        position: relative;
      }
      .nprogress-custom-parent #nprogress .spinner,
      .nprogress-custom-parent #nprogress .bar {
        position: absolute;
      }
      @-webkit-keyframes nprogress-spinner {
        0% {
          -webkit-transform: rotate(0deg);
        }
        100% {
          -webkit-transform: rotate(360deg);
        }
      }
      @keyframes nprogress-spinner {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style><div class="Style_container__qv2Yk Styles_common_container__u_XHj template-container"><header class="Styles_container__5FUI_ Style_header__IYvBP undefined"><div class="Styles_innerWrapper__ZInvp"><div class="logo-holder button vac" style="display:inline-block"><svg width="45" height="43" viewBox="0 0 35 43" fill="none" xmlns="http://www.w3.org/2000/svg" class="vac-logo"><g clip-path="url(#clip0_917_3082)"><path d="M24.9034 14.8217C24.6824 11.2666 23.5308 7.8298 21.5623 4.84994C22.543 4.19721 23.7374 3.93844 24.9034 4.12603C25.492 4.23064 26.0472 4.4722 26.5233 4.83086C26.9994 5.18951 27.3828 5.65504 27.6421 6.18916C28.0141 7.1512 28.1335 8.19117 27.989 9.21147C27.9754 9.6728 27.8955 10.1299 27.7516 10.5688C27.6613 10.8504 27.5322 11.1183 27.3682 11.3651C27.166 11.69 26.9466 12.0041 26.7109 12.3062C26.1084 13.1206 25.5607 14.0073 24.9034 14.8217Z" fill="#999999"></path><path d="M16.7058 7.58268C15.8382 5.99003 14.5344 4.67263 12.9447 3.78217L10.9546 2.69631C10.9546 2.69631 13.2551 -0.778436 16.1945 0.162641C19.134 1.10372 18.1846 7.4017 17.5821 9.80869" fill="#4D4D4D"></path><path d="M20.3209 41.6243C17.4179 40.4118 16.2129 38.3668 14.6975 36.919C13.1821 35.4711 12.8717 29.3903 13.1638 24.6126C13.456 19.8348 17.4909 11.528 17.5822 9.80869C17.6735 8.08941 15.4643 5.17569 13.5655 3.78217C11.6491 2.2631 9.29769 1.38272 6.84668 1.2666L8.36207 2.51534C9.74965 3.67359 9.42101 3.98125 9.22018 6.26155C9.01935 8.54185 8.72722 15.6904 8.70896 21.8436C8.70896 30.3495 6.73713 32.7022 13.0178 38.8373C14.1564 40.1358 15.6863 41.0368 17.3814 41.4072C21.6902 43.036 24.228 43.2712 20.3209 41.6243Z" fill="#1A1A1A"></path><path d="M17.9839 7.07618C17.5904 9.58823 16.8212 12.0281 15.7016 14.3152C14.6765 16.6746 13.7925 19.0918 13.0543 21.5543C12.076 25.3846 11.8405 29.3642 12.3605 33.2816C12.4325 34.6426 12.8065 35.9712 13.4559 37.1726C14.1362 38.1272 14.9759 38.9596 15.939 39.6338C17.8321 41.3312 20.1651 42.4718 22.6761 42.9276C20.068 40.8547 18.189 38.0165 17.3083 34.8199C16.3002 31.5246 16.6412 27.9684 18.2577 24.9205C18.7142 24.0699 19.2436 23.2555 19.7731 22.4411L24.4653 15.3287C24.7022 15.0187 24.8815 14.6694 24.9948 14.2971C25.0769 13.891 25.0769 13.4727 24.9948 13.0665C24.3347 9.48034 22.792 6.11109 20.5034 3.25758C19.9266 2.35717 19.1529 1.59688 18.2395 1.033C17.3262 0.46911 16.2966 0.116066 15.2269 0C15.7121 0.03052 16.1783 0.198543 16.5699 0.484084C16.9616 0.769625 17.2622 1.16066 17.4361 1.61069C17.8159 2.51034 18.0085 3.47679 18.0021 4.45202C18.0507 5.32627 18.0446 6.20267 17.9839 7.07618Z" fill="#808080"></path><path d="M34.927 21.7174C34.8742 21.5895 34.8068 21.4681 34.7261 21.3554C34.5725 21.0145 34.3893 20.6875 34.1784 20.3781C34.0141 20.1429 33.8315 19.9257 33.6489 19.7085C33.2107 19.1294 33.0829 18.3874 32.5352 17.8988C32.2726 17.6504 32.0907 17.33 32.0126 16.9787C31.9346 16.6273 31.964 16.2609 32.097 15.9261C32.2066 15.6366 32.4074 15.4013 32.5352 15.1298C32.6706 14.7258 32.7195 14.2982 32.6786 13.8744C32.6378 13.4505 32.5081 13.0398 32.2979 12.6685C31.7956 11.6016 31.1838 10.5888 30.4721 9.64624C29.5227 8.32511 28.5185 7.05828 27.4596 5.82764C27.6672 6.89431 27.6423 7.99266 27.3865 9.04902C27.2386 9.62495 27.0432 10.1879 26.8023 10.7321C26.4264 11.4007 26.0118 12.0473 25.5608 12.6685C23.2238 16.2881 20.832 19.9076 18.349 23.4004C17.0435 25.5573 16.3321 28.0161 16.2859 30.5309C16.0848 32.9993 16.618 35.472 17.8195 37.6433C18.5687 38.8742 19.4502 40.021 20.4486 41.0637C21.0694 41.7334 21.7814 42.8735 22.6395 43.0726C22.7491 42.041 22.9499 40.6475 23.096 39.6159C23.3338 37.934 23.8782 36.3089 24.7027 34.8201C25.1895 33.7601 26.0543 32.9158 27.1309 32.4493C27.9135 32.2862 28.7218 32.2862 29.5044 32.4493C29.9422 32.4221 30.3812 32.4221 30.819 32.4493C31.2686 32.4735 31.7149 32.3597 32.097 32.1235C32.3186 31.968 32.5024 31.7655 32.6351 31.5307C32.7677 31.2959 32.8459 31.0347 32.8638 30.7662C32.9186 30.2791 32.9186 29.7874 32.8638 29.3003C32.8245 28.9868 32.8685 28.6686 32.9916 28.3773C33.2473 27.8525 34.0141 27.6172 34.0689 27.02C34.0476 26.7523 33.9665 26.4927 33.8315 26.2599C33.7604 26.1456 33.7228 26.014 33.7228 25.8798C33.7228 25.7456 33.7604 25.614 33.8315 25.4998C33.8315 25.4998 34.0506 25.355 34.1236 25.2464C34.2051 25.1396 34.2492 25.0093 34.2492 24.8754C34.2492 24.7415 34.2051 24.6112 34.1236 24.5044C33.9428 24.2955 33.8006 24.0566 33.7037 23.7986C33.695 23.6656 33.715 23.5323 33.7622 23.4075C33.8094 23.2827 33.8828 23.1692 33.9776 23.0747C34.1732 22.888 34.3945 22.7295 34.6348 22.6041C34.7511 22.5516 34.8541 22.4739 34.9362 22.3769C35.0183 22.2798 35.0776 22.1658 35.1095 22.0431C35.0688 21.9246 35.0069 21.8143 34.927 21.7174Z" fill="#CCCCCC"></path><path d="M34.3062 20.5771C34.478 20.8248 34.619 21.0922 34.7261 21.3734C34.8037 21.4816 34.8709 21.5967 34.9269 21.7173L34.3062 20.5771Z" fill="#CCCCCC"></path><path d="M10.133 33.4262C9.0523 28.5693 8.7138 23.5789 9.12886 18.6223C9.12886 16.1429 11.265 2.44302 7.79605 1.41145C4.85656 0.524668 2.53783 3.94512 2.53783 3.94512C0.667683 7.68216 -0.206002 11.8316 1.36513e-05 15.9982C2.30048 38.8193 17.6735 41.4615 18.2577 41.7149C18.2577 41.7149 11.4476 39.2898 10.133 33.4262Z" fill="#09212A"></path></g><defs><clipPath id="clip0_917_3082"><rect width="35" height="43"></rect></clipPath></defs></svg></div><div class="Styles_searchBox__5X2m1"><div class="Styles_container__ddCFx "><div class="logos-search-box Styles_searchBox__xWHyX"><div><input type="text" placeholder="Search Vac Research" value=""/></div></div></div></div></div></header><div class="page-info"><h1 style="display:none">Vac Research</h1><div class="page-info-sub"><i>Mar 17 2023</i><br/><span>staging.vac.dev</span></div></div><main class="undefined Styles_common_main__4v7gP Styles_common_main__4v7gP"><aside class="Styles_container__3yUcn Style_sidebar__mLS5A Styles_common_sidebar__QAVov hidden-scroll Styles_hideDesktopToggleButton__L_Rik"><div class="sidebar-toggle-button button Styles_mobile___qAwf"><svg width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 4h14c.55 0 1-.45 1-1s-.45-1-1-1H1c-.55 0-1 .45-1 1s.45 1 1 1Zm14 8H1c-.55 0-1 .45-1 1s.45 1 1 1h14c.55 0 1-.45 1-1s-.45-1-1-1Zm0-5H1c-.55 0-1 .45-1 1s.45 1 1 1h14c.55 0 1-.45 1-1s-.45-1-1-1Z" fill="#F2F2F2"></path></svg></div><div class="logo-holder button vac" style="display:inline-block"><svg width="45" height="43" viewBox="0 0 35 43" fill="none" xmlns="http://www.w3.org/2000/svg" class="vac-logo"><g clip-path="url(#clip0_917_3082)"><path d="M24.9034 14.8217C24.6824 11.2666 23.5308 7.8298 21.5623 4.84994C22.543 4.19721 23.7374 3.93844 24.9034 4.12603C25.492 4.23064 26.0472 4.4722 26.5233 4.83086C26.9994 5.18951 27.3828 5.65504 27.6421 6.18916C28.0141 7.1512 28.1335 8.19117 27.989 9.21147C27.9754 9.6728 27.8955 10.1299 27.7516 10.5688C27.6613 10.8504 27.5322 11.1183 27.3682 11.3651C27.166 11.69 26.9466 12.0041 26.7109 12.3062C26.1084 13.1206 25.5607 14.0073 24.9034 14.8217Z" fill="#999999"></path><path d="M16.7058 7.58268C15.8382 5.99003 14.5344 4.67263 12.9447 3.78217L10.9546 2.69631C10.9546 2.69631 13.2551 -0.778436 16.1945 0.162641C19.134 1.10372 18.1846 7.4017 17.5821 9.80869" fill="#4D4D4D"></path><path d="M20.3209 41.6243C17.4179 40.4118 16.2129 38.3668 14.6975 36.919C13.1821 35.4711 12.8717 29.3903 13.1638 24.6126C13.456 19.8348 17.4909 11.528 17.5822 9.80869C17.6735 8.08941 15.4643 5.17569 13.5655 3.78217C11.6491 2.2631 9.29769 1.38272 6.84668 1.2666L8.36207 2.51534C9.74965 3.67359 9.42101 3.98125 9.22018 6.26155C9.01935 8.54185 8.72722 15.6904 8.70896 21.8436C8.70896 30.3495 6.73713 32.7022 13.0178 38.8373C14.1564 40.1358 15.6863 41.0368 17.3814 41.4072C21.6902 43.036 24.228 43.2712 20.3209 41.6243Z" fill="#1A1A1A"></path><path d="M17.9839 7.07618C17.5904 9.58823 16.8212 12.0281 15.7016 14.3152C14.6765 16.6746 13.7925 19.0918 13.0543 21.5543C12.076 25.3846 11.8405 29.3642 12.3605 33.2816C12.4325 34.6426 12.8065 35.9712 13.4559 37.1726C14.1362 38.1272 14.9759 38.9596 15.939 39.6338C17.8321 41.3312 20.1651 42.4718 22.6761 42.9276C20.068 40.8547 18.189 38.0165 17.3083 34.8199C16.3002 31.5246 16.6412 27.9684 18.2577 24.9205C18.7142 24.0699 19.2436 23.2555 19.7731 22.4411L24.4653 15.3287C24.7022 15.0187 24.8815 14.6694 24.9948 14.2971C25.0769 13.891 25.0769 13.4727 24.9948 13.0665C24.3347 9.48034 22.792 6.11109 20.5034 3.25758C19.9266 2.35717 19.1529 1.59688 18.2395 1.033C17.3262 0.46911 16.2966 0.116066 15.2269 0C15.7121 0.03052 16.1783 0.198543 16.5699 0.484084C16.9616 0.769625 17.2622 1.16066 17.4361 1.61069C17.8159 2.51034 18.0085 3.47679 18.0021 4.45202C18.0507 5.32627 18.0446 6.20267 17.9839 7.07618Z" fill="#808080"></path><path d="M34.927 21.7174C34.8742 21.5895 34.8068 21.4681 34.7261 21.3554C34.5725 21.0145 34.3893 20.6875 34.1784 20.3781C34.0141 20.1429 33.8315 19.9257 33.6489 19.7085C33.2107 19.1294 33.0829 18.3874 32.5352 17.8988C32.2726 17.6504 32.0907 17.33 32.0126 16.9787C31.9346 16.6273 31.964 16.2609 32.097 15.9261C32.2066 15.6366 32.4074 15.4013 32.5352 15.1298C32.6706 14.7258 32.7195 14.2982 32.6786 13.8744C32.6378 13.4505 32.5081 13.0398 32.2979 12.6685C31.7956 11.6016 31.1838 10.5888 30.4721 9.64624C29.5227 8.32511 28.5185 7.05828 27.4596 5.82764C27.6672 6.89431 27.6423 7.99266 27.3865 9.04902C27.2386 9.62495 27.0432 10.1879 26.8023 10.7321C26.4264 11.4007 26.0118 12.0473 25.5608 12.6685C23.2238 16.2881 20.832 19.9076 18.349 23.4004C17.0435 25.5573 16.3321 28.0161 16.2859 30.5309C16.0848 32.9993 16.618 35.472 17.8195 37.6433C18.5687 38.8742 19.4502 40.021 20.4486 41.0637C21.0694 41.7334 21.7814 42.8735 22.6395 43.0726C22.7491 42.041 22.9499 40.6475 23.096 39.6159C23.3338 37.934 23.8782 36.3089 24.7027 34.8201C25.1895 33.7601 26.0543 32.9158 27.1309 32.4493C27.9135 32.2862 28.7218 32.2862 29.5044 32.4493C29.9422 32.4221 30.3812 32.4221 30.819 32.4493C31.2686 32.4735 31.7149 32.3597 32.097 32.1235C32.3186 31.968 32.5024 31.7655 32.6351 31.5307C32.7677 31.2959 32.8459 31.0347 32.8638 30.7662C32.9186 30.2791 32.9186 29.7874 32.8638 29.3003C32.8245 28.9868 32.8685 28.6686 32.9916 28.3773C33.2473 27.8525 34.0141 27.6172 34.0689 27.02C34.0476 26.7523 33.9665 26.4927 33.8315 26.2599C33.7604 26.1456 33.7228 26.014 33.7228 25.8798C33.7228 25.7456 33.7604 25.614 33.8315 25.4998C33.8315 25.4998 34.0506 25.355 34.1236 25.2464C34.2051 25.1396 34.2492 25.0093 34.2492 24.8754C34.2492 24.7415 34.2051 24.6112 34.1236 24.5044C33.9428 24.2955 33.8006 24.0566 33.7037 23.7986C33.695 23.6656 33.715 23.5323 33.7622 23.4075C33.8094 23.2827 33.8828 23.1692 33.9776 23.0747C34.1732 22.888 34.3945 22.7295 34.6348 22.6041C34.7511 22.5516 34.8541 22.4739 34.9362 22.3769C35.0183 22.2798 35.0776 22.1658 35.1095 22.0431C35.0688 21.9246 35.0069 21.8143 34.927 21.7174Z" fill="#CCCCCC"></path><path d="M34.3062 20.5771C34.478 20.8248 34.619 21.0922 34.7261 21.3734C34.8037 21.4816 34.8709 21.5967 34.9269 21.7173L34.3062 20.5771Z" fill="#CCCCCC"></path><path d="M10.133 33.4262C9.0523 28.5693 8.7138 23.5789 9.12886 18.6223C9.12886 16.1429 11.265 2.44302 7.79605 1.41145C4.85656 0.524668 2.53783 3.94512 2.53783 3.94512C0.667683 7.68216 -0.206002 11.8316 1.36513e-05 15.9982C2.30048 38.8193 17.6735 41.4615 18.2577 41.7149C18.2577 41.7149 11.4476 39.2898 10.133 33.4262Z" fill="#09212A"></path></g><defs><clipPath id="clip0_917_3082"><rect width="35" height="43"></rect></clipPath></defs></svg></div><div class="Styles_desktop__VH2y3 defaultSidebar Styles_container__4YC7p"><nav class="sidebarNav hidden-scroll"><ul class="sidebar-menu mainMenu Styles_menu__izFC1"><li class="Styles_menuItem__BqRqE menuitem level-0"><span></span><ul class="sidebar-menu  Styles_menu__izFC1"><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Main" href="/">Main</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="principles" href="/principles">Principles</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Research areas" href="/research-areas">Research areas</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Projects" href="/projects">Projects</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Open Research Problems" href="/open-problems">Open Research Problems</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="publications" href="/publications">Publications</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="contribute" href="/contribute">Contribute</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="media" href="/media">Media</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li></ul><br/></li></ul><br/><ul class="sidebar-menu subMenu Styles_menu__izFC1"><li class="Styles_menuItem__BqRqE menuitem level-0"><a class="" title="research" href="/research">Research</a><ul class="sidebar-menu  Styles_menu__izFC1"><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Waku for All Decentralized Applications and Infrastructures" href="/waku-for-all">Waku for All Decentralized Applications and Infrastructures</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Building Privacy-Protecting Infrastructure" href="/building-privacy-protecting-infrastructure">Building Privacy-Protecting Infrastructure</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Waku Privacy and Anonymity Analysis Part I: Definitions and Waku Relay" href="/wakuv2-relay-anon">Waku Privacy and Anonymity Analysis Part I: Definitions and Waku Relay</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Noise handshakes as key-exchange mechanism for Waku" href="/wakuv2-noise">Noise handshakes as key-exchange mechanism for Waku</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Waku v2 Ambient Peer Discovery" href="/wakuv2-apd">Waku v2 Ambient Peer Discovery</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Introducing nwaku" href="/introducing-nwaku">Introducing nwaku</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li class="Styles_menuItem__BqRqE menuitem level-1"><a class="" title="Opinion: Pseudo-ethics in the Surveillance Tech Industry" href="/ethics-surveillance-tech">Opinion: Pseudo-ethics in the Surveillance Tech Industry</a><ul class="sidebar-menu  Styles_menu__izFC1"></ul></li><li><span class="button">...</span></li></ul><br/></li></ul><div class="external_links"><div><div class="menuitem-title"><span class="cap">Resources</span></div><ul><li><a href="https://rfc.vac.dev/" target="_blank">&gt; Specs/RFCs</a></li><li><a href="https://forum.vac.dev/" target="_blank">&gt; Forum</a></li><li><a href="https://waku.org" target="_blank">&gt; Waku.org</a></li></ul></div></div></nav></div></aside><article class="Styles_container__pG0bG Style_content__NTXHZ Styles_common_content__Myi5Z"><div class="Style_container__qc2tD"><h2 class="Style_container__eSI4Q serif">Waku v1 vs Waku v2: Bandwidth Comparison</h2><div class="serif"><i>Nov 03 2021</i><i> - </i>by<!-- --><a title="hanno" href="/authors/hanno"><span><i> <!-- -->hanno<!-- --></i></span></a></div></div><h2><a class="anchor" id="background"></a><a class="ha" href="#background">Background<!-- --></a></h2>
<!-- --><p>The <!-- --><a href="https://vac.dev/waku-v2-plan">original plan<!-- --></a> for Waku v2 suggested theoretical improvements in resource usage over Waku v1,
mainly as a result of the improved amplification factors provided by GossipSub.
In its turn, <!-- --><a href="https://vac.dev/fixing-whisper-with-waku">Waku v1 proposed improvements<!-- --></a> over its predecessor, Whisper.<!-- --></p>
<!-- --><p>Given that Waku v2 is aimed at resource restricted environments,
we are specifically interested in its scalability and resource usage characteristics.
However, the theoretical performance improvements of Waku v2 over Waku v1,
has never been properly benchmarked and tested.<!-- --></p>
<!-- --><p>Although we&#x27;re working towards a full performance evaluation of Waku v2,
this would require significant planning and resources,
if it were to simulate &quot;real world&quot; conditions faithfully and measure bandwidth and resource usage across different network connections,
robustness against attacks/losses, message latencies, etc.
(There already exists a fairly comprehensive <!-- --><a href="https://research.protocol.ai/publications/gossipsub-v1.1-evaluation-report/vyzovitis2020.pdf">evaluation of GossipSub v1.1<!-- --></a>,
on which <!-- --><a href="https://rfc.vac.dev/spec/11/"><code>11/WAKU2-RELAY</code></a> is based.)<!-- --></p>
<!-- --><p>As a starting point,
this post contains a limited and local comparison of the <!-- --><em>bandwidth<!-- --></em> profile (only) between Waku v1 and Waku v2.
It reuses and adapts existing network simulations for <!-- --><a href="https://github.com/status-im/nim-waku/blob/master/waku/v1/node/quicksim.nim">Waku v1<!-- --></a> and <!-- --><a href="https://github.com/status-im/nim-waku/blob/master/waku/v2/node/quicksim2.nim">Waku v2<!-- --></a>
and compares bandwidth usage for similar message propagation scenarios.<!-- --></p>
<!-- --><h2><a class="anchor" id="theoretical-improvements-in-waku-v2"></a><a class="ha" href="#theoretical-improvements-in-waku-v2">Theoretical improvements in Waku v2<!-- --></a></h2>
<!-- --><p>Messages are propagated in Waku v1 using <!-- --><a href="https://en.wikipedia.org/wiki/Flooding_(computer_networking)">flood routing<!-- --></a>.
This means that every peer will forward every new incoming message to all its connected peers (except the one it received the message from).
This necessarily leads to unnecessary duplication (termed <!-- --><em>amplification factor<!-- --></em>),
wasting bandwidth and resources.
What&#x27;s more, we expect this effect to worsen the larger the network becomes,
as each <!-- --><em>connection<!-- --></em> will receive a copy of each message,
rather than a single copy per peer.<!-- --></p>
<!-- --><p>Message routing in Waku v2 follows the <!-- --><code>libp2p</code> <!-- --><em>GossipSub<!-- --></em> protocol,
which lowers amplification factors by only sending full message contents to a subset of connected peers.
As a Waku v2 network grows, each peer will limit its number of full-message (&quot;mesh&quot;) peerings -
<!-- --><code>libp2p</code> suggests a maximum of <!-- --><code>12</code> such connections per peer.
This allows much better scalability than a flood-routed network.
From time to time, a Waku v2 peer will send metadata about the messages it has seen to other peers (&quot;gossip&quot; peers).<!-- --></p>
<!-- --><p>See <!-- --><a href="https://hackmd.io/@vac/main/%2FYYlZYBCURFyO_ZG1EiteWg#11WAKU2-RELAY-gossipsub">this explainer<!-- --></a> for a more detailed discussion.<!-- --></p>
<!-- --><h2><a class="anchor" id="methodology"></a><a class="ha" href="#methodology">Methodology<!-- --></a></h2>
<!-- --><p>The results below contain only some scenarios that provide an interesting contrast between Waku v1 and Waku v2.
For example, <!-- --><a href="https://en.wikipedia.org/wiki/Star_network">star network topologies<!-- --></a> do not show a substantial difference between Waku v1 and Waku v2.
This is because each peer relies on a single connection to the central node for every message,
which barely requires any routing:
each connection receives a copy of every message for both Waku v1 and Waku v2.
Hybrid topologies similarly show only a difference between Waku v1 and Waku v2 for network segments with <!-- --><a href="https://en.wikipedia.org/wiki/Mesh_networking">mesh-like connections<!-- --></a>,
where routing decisions need to be made.<!-- --></p>
<!-- --><p>For this reason, the following approach applies to all iterations:<!-- --></p>
<!-- --><ol>
<!-- --><li>Simulations are run <!-- --><strong>locally<!-- --></strong>.
This limits the size of possible scenarios due to local resource constraints,
but is a way to quickly get an approximate comparison.<!-- --></li>
<!-- --><li>Nodes are treated as a <!-- --><strong>blackbox<!-- --></strong> for which we only measure bandwidth,
using an external bandwidth monitoring tool.
In other words, we do not consider differences in the size of the envelope (for v1) or the message (for v2).<!-- --></li>
<!-- --><li>Messages are published at a rate of <!-- --><strong>50 new messages per second<!-- --></strong> to each network,
except where explicitly stated otherwise.<!-- --></li>
<!-- --><li>Each message propagated in the network carries <!-- --><strong>8 bytes<!-- --></strong> of random payload, which is <!-- --><strong>encrypted<!-- --></strong>.
The same symmetric key cryptographic algorithm (with the same keys) are used in both Waku v1 and v2.<!-- --></li>
<!-- --><li>Traffic in each network is <!-- --><strong>generated from 10 nodes<!-- --></strong> (randomly-selected) and published in a round-robin fashion to <!-- --><strong>10 topics<!-- --></strong> (content topics for Waku v2).
In practice, we found no significant difference in <!-- --><em>average<!-- --></em> bandwidth usage when tweaking these two parameters (the number of traffic generating nodes and the number of topics).<!-- --></li>
<!-- --><li>Peers are connected in a decentralized <!-- --><strong>full mesh topology<!-- --></strong>,
i.e. each peer is connected to every other peer in the network.
Waku v1 is expected to flood all messages across all existing connections.
Waku v2 gossipsub will GRAFT some of these connections for full-message peerings,
with the rest being gossip-only peerings.<!-- --></li>
<!-- --><li>After running each iteration, we <!-- --><strong>verify that messages propagated to all peers<!-- --></strong> (comparing the number of published messages to the metrics logged by each peer).<!-- --></li>
<!-- --></ol>
<!-- --><p>For Waku v1, nodes are configured as &quot;full&quot; nodes (i.e. with full bloom filter),
while Waku v2 nodes are <!-- --><code>relay</code> nodes, all subscribing and publishing to the same PubSub topic.<!-- --></p>
<!-- --><h2><a class="anchor" id="network-size-comparison"></a><a class="ha" href="#network-size-comparison">Network size comparison<!-- --></a></h2>
<!-- --><h3><a class="anchor" id="iteration-1-10-nodes"></a><a class="ha" href="#iteration-1-10-nodes">Iteration 1: 10 nodes<!-- --></a></h3>
<!-- --><p>Let&#x27;s start with a small network of 10 nodes only and see how Waku v1 bandwidth usage compares to that of Waku v2.
At this small scale we don&#x27;t expect to see improved bandwidth usage in Waku v2 over Waku v1,
since all connections, for both Waku v1 and Waku v2, will be full-message connections.
The number of connections is low enough that Waku v2 nodes will likely GRAFT all connections to full-message peerings,
essentially flooding every message on every connection in a similar fashion to Waku v1.
If our expectations are confirmed, it helps validate our methodology,
showing that it gives more or less equivalent results between Waku v1 and Waku v2 networks.<!-- --></p>
<!-- --><figure class="rehype-figure"><img src="/compiled-assets//img/waku1-vs-waku2/waku1-vs-waku2-10-nodes.png" alt=""/></figure>
<!-- --><p>Sure enough, the figure shows that in this small-scale setup,
Waku v1 actually has a lower per-peer bandwidth usage than Waku v2.
One reason for this may be the larger overall proportion of control messages in a gossipsub-routed network such as Waku v2.
These play a larger role when the total network traffic is comparatively low, as in this iteration.
Also note that the average bandwidth remains more or less constant as long as the rate of published messages remains stable.<!-- --></p>
<!-- --><h3><a class="anchor" id="iteration-2-30-nodes"></a><a class="ha" href="#iteration-2-30-nodes">Iteration 2: 30 nodes<!-- --></a></h3>
<!-- --><p>Now, let&#x27;s run the same scenario for a larger network of highly-connected nodes, this time consisting of 30 nodes.
At this point, the Waku v2 nodes will start pruning some connections to limit the number of full-message peerings (to a maximum of <!-- --><code>12</code>),
while the Waku v1 nodes will continue flooding messages to all connected peers.
We therefore expect to see a somewhat improved bandwidth usage in Waku v2 over Waku v1.<!-- --></p>
<!-- --><figure class="rehype-figure"><img src="/compiled-assets//img/waku1-vs-waku2/waku1-vs-waku2-30-nodes.png" alt=""/></figure>
<!-- --><p>Bandwidth usage in Waku v2 has increased only slightly from the smaller network of 10 nodes (hovering between 2000 and 3000 kbps).
This is because there are only a few more full-message peerings than before.
Compare this to the much higher increase in bandwidth usage for Waku v1, which now requires more than 4000 kbps on average.<!-- --></p>
<!-- --><h3><a class="anchor" id="iteration-3-50-nodes"></a><a class="ha" href="#iteration-3-50-nodes">Iteration 3: 50 nodes<!-- --></a></h3>
<!-- --><p>For an even larger network of 50 highly connected nodes,
the divergence between Waku v1 and Waku v2 is even larger.
The following figure shows comparative average bandwidth usage for a throughput of 50 messages per second.<!-- --></p>
<!-- --><figure class="rehype-figure"><img src="/compiled-assets//img/waku1-vs-waku2/waku1-vs-waku2-50-nodes.png" alt=""/></figure>
<!-- --><p>Average bandwidth usage (for the same message rate) has remained roughly the same for Waku v2 as it was for 30 nodes,
indicating that the number of full-message peerings per node has not increased.<!-- --></p>
<!-- --><h3><a class="anchor" id="iteration-4-85-nodes"></a><a class="ha" href="#iteration-4-85-nodes">Iteration 4: 85 nodes<!-- --></a></h3>
<!-- --><p>We already see a clear trend in the bandwidth comparisons above,
so let&#x27;s confirm by running the test once more for a network of 85 nodes.
Due to local resource constraints, the effective throughput for Waku v1 falls to below 50 messages per second,
so the v1 results below have been normalized and are therefore approximate.
The local Waku v2 simulation maintains the message throughput rate without any problems.<!-- --></p>
<!-- --><figure class="rehype-figure"><img src="/compiled-assets//img/waku1-vs-waku2/waku1-vs-waku2-85-nodes.png" alt=""/></figure>
<!-- --><h3><a class="anchor" id="iteration-5-150-nodes"></a><a class="ha" href="#iteration-5-150-nodes">Iteration 5: 150 nodes<!-- --></a></h3>
<!-- --><p>Finally, we simulate message propagation in a network of 150 nodes.
Due to local resource constraints, we run this simulation at a lower rate -
35 messages per second -
and for a shorter amount of time.<!-- --></p>
<!-- --><figure class="rehype-figure"><img src="/compiled-assets//img/waku1-vs-waku2/waku1-vs-waku2-150-nodes.png" alt=""/></figure>
<!-- --><p>Notice how the Waku v1 bandwidth usage is now more than 10 times worse than that of Waku v2.
This is to be expected, as each Waku v1 node will try to flood each new message to 149 other peers,
while the Waku v2 nodes limit their full-message peerings to no more than 12.<!-- --></p>
<!-- --><h3><a class="anchor" id="discussion"></a><a class="ha" href="#discussion">Discussion<!-- --></a></h3>
<!-- --><p>Let&#x27;s summarize average bandwidth growth against network growth for a constant message propagation rate.
Since we are particularly interested in how Waku v1 compares to Waku v2 in terms of bandwidth usage,
the results are normalised to the Waku v2 average bandwidth usage for each network size.<!-- --></p>
<!-- --><figure class="rehype-figure"><img src="/compiled-assets//img/waku1-vs-waku2/waku1-vs-waku2-overall-network-size.png" alt=""/></figure>
<!-- --><p>Extrapolation is a dangerous game,
but it&#x27;s safe to deduce that the divergence will only grow for even larger network topologies.
Although control signalling contributes more towards overall bandwidth for Waku v2 networks,
this effect becomes less noticeable for larger networks.
For network segments with more than ~18 densely connected nodes,
the advantage of using Waku v2 above Waku v1 becomes clear.<!-- --></p>
<!-- --><h2><a class="anchor" id="network-traffic-comparison"></a><a class="ha" href="#network-traffic-comparison">Network traffic comparison<!-- --></a></h2>
<!-- --><p>The analysis above controls the average message rate while network size grows.
In reality, however, active users (and therefore message rates) are likely to grow in conjunction with the network.
This will have an effect on bandwidth for both Waku v1 and Waku v2, though not in equal measure.
Consider the impact of an increasing rate of messages in a network of constant size:<!-- --></p>
<!-- --><figure class="rehype-figure"><img src="/compiled-assets//img/waku1-vs-waku2/waku1-vs-waku2-overall-message-rate.png" alt=""/></figure>
<!-- --><p>The <!-- --><em>rate<!-- --></em> of increase in bandwidth for Waku v2 is slower than that for Waku v1 for a corresponding increase in message propagation rate.
In fact, for a network of 30 densely-connected nodes,
if the message propagation rate increases by 1 per second,
Waku v1 requires an increased average bandwidth of almost 70kbps at each node.
A similar traffic increase in Waku v2 requires on average 40kbps more bandwidth per peer, just over half that of Waku v1.<!-- --></p>
<!-- --><h2><a class="anchor" id="conclusions"></a><a class="ha" href="#conclusions">Conclusions<!-- --></a></h2>
<!-- --><ul>
<!-- --><li><strong>Waku v2 scales significantly better than Waku v1 in terms of average bandwidth usage<!-- --></strong>,
especially for densely connected networks.<!-- --></li>
<!-- --><li>E.g. for a network consisting of <!-- --><strong>150<!-- --></strong> or more densely connected nodes,
Waku v2 provides more than <!-- --><strong>10x<!-- --></strong> better average bandwidth usage rates than Waku v1.<!-- --></li>
<!-- --><li>As the network continues to scale, both in absolute terms (number of nodes) and in network traffic (message rates) the disparity between Waku v2 and Waku v1 becomes even larger.<!-- --></li>
<!-- --></ul>
<!-- --><h2><a class="anchor" id="future-work"></a><a class="ha" href="#future-work">Future work<!-- --></a></h2>
<!-- --><p>Now that we&#x27;ve confirmed that Waku v2&#x27;s bandwidth improvements over its predecessor matches theory,
we can proceed to a more in-depth characterisation of Waku v2&#x27;s resource usage.
Some questions that we want to answer include:<!-- --></p>
<!-- --><ul>
<!-- --><li>What proportion of Waku v2&#x27;s bandwidth usage is used to propagate <!-- --><em>payload<!-- --></em> versus bandwidth spent on <!-- --><em>control<!-- --></em> messaging to maintain the mesh?<!-- --></li>
<!-- --><li>To what extent is message latency (time until a message is delivered to its destination) affected by network size and message rate?<!-- --></li>
<!-- --><li>How <!-- --><em>reliable<!-- --></em> is message delivery in Waku v2 for different network sizes and message rates?<!-- --></li>
<!-- --><li>What are the resource usage profiles of other Waku v2 protocols (e.g.<!-- --><a href="https://rfc.vac.dev/spec/12/"><code>12/WAKU2-FILTER</code></a> and <!-- --><a href="https://rfc.vac.dev/spec/19/"><code>19/WAKU2-LIGHTPUSH</code></a>)?<!-- --></li>
<!-- --></ul>
<!-- --><p>Our aim is to get ever closer to a &quot;real world&quot; understanding of Waku v2&#x27;s performance characteristics,
identify and fix vulnerabilities
and continually improve the efficiency of our suite of protocols.<!-- --></p>
<!-- --><h2><a class="anchor" id="references"></a><a class="ha" href="#references">References<!-- --></a></h2>
<!-- --><ul>
<!-- --><li><a href="https://research.protocol.ai/publications/gossipsub-v1.1-evaluation-report/vyzovitis2020.pdf">Evaluation of GossipSub v1.1<!-- --></a></li>
<!-- --><li><a href="https://vac.dev/fixing-whisper-with-waku">Fixing Whisper with Waku<!-- --></a></li>
<!-- --><li><a href="https://hackmd.io/@vac/main/%2FYYlZYBCURFyO_ZG1EiteWg#11WAKU2-RELAY-gossipsub">GossipSub vs flood routing<!-- --></a></li>
<!-- --><li><a href="https://www.techopedia.com/definition/13335/star-topology#:~:text=Star%20topology%20is%20a%20network,known%20as%20a%20star%20network.">Network topologies: star<!-- --></a></li>
<!-- --><li><a href="https://en.wikipedia.org/wiki/Mesh_networking">Network topologies: mesh<!-- --></a></li>
<!-- --><li><a href="https://vac.dev/waku-v2-plan">Waku v2 original plan<!-- --></a></li>
<!-- --></ul></article><aside class="Styles_container__3DqFl Style_toc__v7JJe Styles_common_toc__nMHyQ hidden-scroll"><nav class="Styles_tocComponent__fhPld hidden-scroll"><ul><li class="h-2"><a class="" href="/waku-v1-v2-bandwidth-comparison#background">Background</a></li><li class="h-2"><a class="" href="/waku-v1-v2-bandwidth-comparison#theoretical-improvements-in-waku-v2">Theoretical improvements in Waku v2</a></li><li class="h-2"><a class="" href="/waku-v1-v2-bandwidth-comparison#methodology">Methodology</a></li><li class="h-2"><a class="" href="/waku-v1-v2-bandwidth-comparison#network-size-comparison">Network size comparison</a></li><li class="h-3"><a class="" href="/waku-v1-v2-bandwidth-comparison#iteration-1-10-nodes">Iteration 1: 10 nodes</a></li><li class="h-3"><a class="" href="/waku-v1-v2-bandwidth-comparison#iteration-2-30-nodes">Iteration 2: 30 nodes</a></li><li class="h-3"><a class="" href="/waku-v1-v2-bandwidth-comparison#iteration-3-50-nodes">Iteration 3: 50 nodes</a></li><li class="h-3"><a class="" href="/waku-v1-v2-bandwidth-comparison#iteration-4-85-nodes">Iteration 4: 85 nodes</a></li><li class="h-3"><a class="" href="/waku-v1-v2-bandwidth-comparison#iteration-5-150-nodes">Iteration 5: 150 nodes</a></li><li class="h-3"><a class="" href="/waku-v1-v2-bandwidth-comparison#discussion">Discussion</a></li><li class="h-2"><a class="" href="/waku-v1-v2-bandwidth-comparison#network-traffic-comparison">Network traffic comparison</a></li><li class="h-2"><a class="" href="/waku-v1-v2-bandwidth-comparison#conclusions">Conclusions</a></li><li class="h-2"><a class="" href="/waku-v1-v2-bandwidth-comparison#future-work">Future work</a></li><li class="h-2"><a class="" href="/waku-v1-v2-bandwidth-comparison#references">References</a></li></ul></nav></aside></main><footer class="Styles_container___YkOC undefined Styles_common_footer__1rPoh"><div class="footer-content-container Styles_content__0jn9p"><div><p><span class="copy-left">©</span><span>2023<!-- --></span><span> Vac Research</span><span> - </span><span>Vac - Communication, Privacy, Etc</span></p></div><div class="Styles_bottomPart__CsMh_"><div class="Styles_socialMedia__AmAKz "><span><a href="https://twitter.com/vacp2p" class="button"><svg xmlns="http://www.w3.org/2000/svg" width="30" viewBox="0 0 543.684 543.684" xml:space="preserve"><path d="M527.657 106.697a231.362 231.362 0 0 1-8.041 2.191c-16.384 4.137-17.89-1.322-6.028-13.366a109.306 109.306 0 0 0 14.082-17.607c9.137-14.217 1.212-20.417-14.333-13.776a224.853 224.853 0 0 1-16.897 6.432c-16.017 5.379-38.746-2.735-53.018-11.787-18.018-11.426-38.495-17.136-61.438-17.136-32.137 0-59.529 11.334-82.192 33.984-22.656 22.662-33.99 50.062-33.99 82.191 0 4.394.251 8.855.747 13.378.814 7.362-11.585 12.699-28.317 10.336-36.194-5.11-70.582-16.077-103.171-32.889-32.32-16.671-60.845-37.65-85.57-62.938-11.819-12.086-27.804-11.045-32.217 5.27-2.644 9.78-3.959 19.951-3.959 30.515 0 19.908 4.675 38.372 14.027 55.392 4.651 8.47 10.098 16.138 16.353 22.999 10.521 11.549 8.911 18.25-5.734 14.144-14.639-4.106-25.367-10.202-25.367-9.804v.722c0 28.048 8.807 52.693 26.432 73.911 10.857 13.072 23.47 23.17 37.834 30.282 15.147 7.503 22.203 11.688 13.733 12.784-5.11.661-10.251.991-15.422.991-3.5 0-7.172-.159-11.003-.483-6.059-.514-7.148 12.111 2.038 26.298 7.301 11.273 16.646 21.193 28.03 29.762 11.579 8.721 24.058 14.981 37.417 18.794 16.255 4.633 19.517 13.073 5.024 21.763-35.863 21.519-75.551 32.277-119.058 32.277-4.902 0-9.578-.11-14.045-.324-7.754-.373-2.552 6.456 12.417 14.296 46.775 24.499 97.43 36.738 151.972 36.738 41.237 0 79.964-6.529 116.176-19.596 36.199-13.066 67.136-30.576 92.791-52.516 25.655-21.94 47.779-47.173 66.365-75.711 18.581-28.537 32.424-58.33 41.543-89.376 9.106-31.053 13.666-62.167 13.666-93.342 0-2.809-.024-5.331-.067-7.552-.086-4.174 10.955-15.472 23.28-27.032a242.397 242.397 0 0 0 15.937-16.444c11.179-12.688 6.228-18.502-9.997-13.771z"></path></svg></a></span><span><a href="https://discord.gg/PQFdubGt6d" class="button"><svg width="30" viewBox="0 0 71 55" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#discord_svg__a)"><path d="M60.105 4.898A58.55 58.55 0 0 0 45.653.415a.22.22 0 0 0-.233.11 40.784 40.784 0 0 0-1.8 3.697c-5.456-.817-10.886-.817-16.23 0-.485-1.164-1.201-2.587-1.828-3.697a.228.228 0 0 0-.233-.11 58.386 58.386 0 0 0-14.451 4.483.207.207 0 0 0-.095.082C1.578 18.73-.944 32.144.293 45.39a.244.244 0 0 0 .093.167c6.073 4.46 11.955 7.167 17.729 8.962a.23.23 0 0 0 .249-.082 42.08 42.08 0 0 0 3.627-5.9.225.225 0 0 0-.123-.312 38.772 38.772 0 0 1-5.539-2.64.228.228 0 0 1-.022-.378c.372-.279.744-.569 1.1-.862a.22.22 0 0 1 .23-.03c11.619 5.304 24.198 5.304 35.68 0a.219.219 0 0 1 .233.027c.356.293.728.586 1.103.865a.228.228 0 0 1-.02.378 36.384 36.384 0 0 1-5.54 2.637.227.227 0 0 0-.121.315 47.249 47.249 0 0 0 3.624 5.897.225.225 0 0 0 .249.084c5.801-1.794 11.684-4.502 17.757-8.961a.228.228 0 0 0 .092-.164c1.48-15.315-2.48-28.618-10.497-40.412a.18.18 0 0 0-.093-.084Zm-36.38 32.427c-3.497 0-6.38-3.211-6.38-7.156 0-3.944 2.827-7.156 6.38-7.156 3.583 0 6.438 3.24 6.382 7.156 0 3.945-2.827 7.156-6.381 7.156Zm23.593 0c-3.498 0-6.38-3.211-6.38-7.156 0-3.944 2.826-7.156 6.38-7.156 3.582 0 6.437 3.24 6.38 7.156 0 3.945-2.798 7.156-6.38 7.156Z" fill="#23272A"></path></g><defs><clipPath id="discord_svg__a"><path fill="#fff" d="M0 0h71v55H0z"></path></clipPath></defs></svg></a></span><span><a href="https://github.com/vacp2p" class="button"><svg width="30" viewBox="0 0 1024 1024" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M512 0C229.12 0 0 229.12 0 512c0 226.56 146.56 417.92 350.08 485.76 25.6 4.48 35.2-10.88 35.2-24.32 0-12.16-.64-52.48-.64-95.36-128.64 23.68-161.92-31.36-172.16-60.16-5.76-14.72-30.72-60.16-52.48-72.32-17.92-9.6-43.52-33.28-.64-33.92 40.32-.64 69.12 37.12 78.72 52.48 46.08 77.44 119.68 55.68 149.12 42.24 4.48-33.28 17.92-55.68 32.64-68.48-113.92-12.8-232.96-56.96-232.96-252.8 0-55.68 19.84-101.76 52.48-137.6-5.12-12.8-23.04-65.28 5.12-135.68 0 0 42.88-13.44 140.8 52.48 40.96-11.52 84.48-17.28 128-17.28 43.52 0 87.04 5.76 128 17.28 97.92-66.56 140.8-52.48 140.8-52.48 28.16 70.4 10.24 122.88 5.12 135.68 32.64 35.84 52.48 81.28 52.48 137.6 0 196.48-119.68 240-233.6 252.8 18.56 16 34.56 46.72 34.56 94.72 0 68.48-.64 123.52-.64 140.8 0 13.44 9.6 29.44 35.2 24.32C877.44 929.92 1024 737.92 1024 512 1024 229.12 794.88 0 512 0Z" fill="#1B1F23"></path></svg></a></span></div><nav class="Styles_legal__0ciDG"><a title="Privacy Policy" href="/privacy-policy">Privacy Policy</a></nav></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"markdown":{"content":"\n## Background\n\nThe [original plan](https://vac.dev/waku-v2-plan) for Waku v2 suggested theoretical improvements in resource usage over Waku v1,\nmainly as a result of the improved amplification factors provided by GossipSub.\nIn its turn, [Waku v1 proposed improvements](https://vac.dev/fixing-whisper-with-waku) over its predecessor, Whisper.\n\nGiven that Waku v2 is aimed at resource restricted environments,\nwe are specifically interested in its scalability and resource usage characteristics.\nHowever, the theoretical performance improvements of Waku v2 over Waku v1,\nhas never been properly benchmarked and tested.\n\nAlthough we're working towards a full performance evaluation of Waku v2,\nthis would require significant planning and resources,\nif it were to simulate \"real world\" conditions faithfully and measure bandwidth and resource usage across different network connections,\nrobustness against attacks/losses, message latencies, etc.\n(There already exists a fairly comprehensive [evaluation of GossipSub v1.1](https://research.protocol.ai/publications/gossipsub-v1.1-evaluation-report/vyzovitis2020.pdf),\non which [`11/WAKU2-RELAY`](https://rfc.vac.dev/spec/11/) is based.)\n\nAs a starting point,\nthis post contains a limited and local comparison of the _bandwidth_ profile (only) between Waku v1 and Waku v2.\nIt reuses and adapts existing network simulations for [Waku v1](https://github.com/status-im/nim-waku/blob/master/waku/v1/node/quicksim.nim) and [Waku v2](https://github.com/status-im/nim-waku/blob/master/waku/v2/node/quicksim2.nim)\nand compares bandwidth usage for similar message propagation scenarios.\n\n## Theoretical improvements in Waku v2\n\nMessages are propagated in Waku v1 using [flood routing](https://en.wikipedia.org/wiki/Flooding_(computer_networking)).\nThis means that every peer will forward every new incoming message to all its connected peers (except the one it received the message from).\nThis necessarily leads to unnecessary duplication (termed _amplification factor_),\nwasting bandwidth and resources.\nWhat's more, we expect this effect to worsen the larger the network becomes,\nas each _connection_ will receive a copy of each message,\nrather than a single copy per peer.\n\nMessage routing in Waku v2 follows the `libp2p` _GossipSub_ protocol,\nwhich lowers amplification factors by only sending full message contents to a subset of connected peers.\nAs a Waku v2 network grows, each peer will limit its number of full-message (\"mesh\") peerings -\n`libp2p` suggests a maximum of `12` such connections per peer.\nThis allows much better scalability than a flood-routed network.\nFrom time to time, a Waku v2 peer will send metadata about the messages it has seen to other peers (\"gossip\" peers).\n\nSee [this explainer](https://hackmd.io/@vac/main/%2FYYlZYBCURFyO_ZG1EiteWg#11WAKU2-RELAY-gossipsub) for a more detailed discussion.\n\n## Methodology\n\nThe results below contain only some scenarios that provide an interesting contrast between Waku v1 and Waku v2.\nFor example, [star network topologies](https://en.wikipedia.org/wiki/Star_network) do not show a substantial difference between Waku v1 and Waku v2.\nThis is because each peer relies on a single connection to the central node for every message,\nwhich barely requires any routing:\neach connection receives a copy of every message for both Waku v1 and Waku v2.\nHybrid topologies similarly show only a difference between Waku v1 and Waku v2 for network segments with [mesh-like connections](https://en.wikipedia.org/wiki/Mesh_networking),\nwhere routing decisions need to be made.\n\nFor this reason, the following approach applies to all iterations:\n1. Simulations are run **locally**.\nThis limits the size of possible scenarios due to local resource constraints,\nbut is a way to quickly get an approximate comparison.\n2. Nodes are treated as a **blackbox** for which we only measure bandwidth,\nusing an external bandwidth monitoring tool.\nIn other words, we do not consider differences in the size of the envelope (for v1) or the message (for v2).\n3. Messages are published at a rate of **50 new messages per second** to each network,\nexcept where explicitly stated otherwise.\n4. Each message propagated in the network carries **8 bytes** of random payload, which is **encrypted**.\nThe same symmetric key cryptographic algorithm (with the same keys) are used in both Waku v1 and v2.\n5. Traffic in each network is **generated from 10 nodes** (randomly-selected) and published in a round-robin fashion to **10 topics** (content topics for Waku v2).\nIn practice, we found no significant difference in _average_ bandwidth usage when tweaking these two parameters (the number of traffic generating nodes and the number of topics).\n6. Peers are connected in a decentralized **full mesh topology**,\ni.e. each peer is connected to every other peer in the network.\nWaku v1 is expected to flood all messages across all existing connections.\nWaku v2 gossipsub will GRAFT some of these connections for full-message peerings,\nwith the rest being gossip-only peerings.\n7. After running each iteration, we **verify that messages propagated to all peers** (comparing the number of published messages to the metrics logged by each peer).\n\nFor Waku v1, nodes are configured as \"full\" nodes (i.e. with full bloom filter),\nwhile Waku v2 nodes are `relay` nodes, all subscribing and publishing to the same PubSub topic.\n\n## Network size comparison\n\n### Iteration 1: 10 nodes\n\nLet's start with a small network of 10 nodes only and see how Waku v1 bandwidth usage compares to that of Waku v2.\nAt this small scale we don't expect to see improved bandwidth usage in Waku v2 over Waku v1,\nsince all connections, for both Waku v1 and Waku v2, will be full-message connections.\nThe number of connections is low enough that Waku v2 nodes will likely GRAFT all connections to full-message peerings,\nessentially flooding every message on every connection in a similar fashion to Waku v1.\nIf our expectations are confirmed, it helps validate our methodology,\nshowing that it gives more or less equivalent results between Waku v1 and Waku v2 networks.\n\n![](//img/waku1-vs-waku2/waku1-vs-waku2-10-nodes.png)\n\nSure enough, the figure shows that in this small-scale setup,\nWaku v1 actually has a lower per-peer bandwidth usage than Waku v2.\nOne reason for this may be the larger overall proportion of control messages in a gossipsub-routed network such as Waku v2.\nThese play a larger role when the total network traffic is comparatively low, as in this iteration.\nAlso note that the average bandwidth remains more or less constant as long as the rate of published messages remains stable.\n\n### Iteration 2: 30 nodes\n\nNow, let's run the same scenario for a larger network of highly-connected nodes, this time consisting of 30 nodes.\nAt this point, the Waku v2 nodes will start pruning some connections to limit the number of full-message peerings (to a maximum of `12`),\nwhile the Waku v1 nodes will continue flooding messages to all connected peers.\nWe therefore expect to see a somewhat improved bandwidth usage in Waku v2 over Waku v1.\n\n![](//img/waku1-vs-waku2/waku1-vs-waku2-30-nodes.png)\n\nBandwidth usage in Waku v2 has increased only slightly from the smaller network of 10 nodes (hovering between 2000 and 3000 kbps).\nThis is because there are only a few more full-message peerings than before.\nCompare this to the much higher increase in bandwidth usage for Waku v1, which now requires more than 4000 kbps on average.\n\n\n### Iteration 3: 50 nodes\n\nFor an even larger network of 50 highly connected nodes,\nthe divergence between Waku v1 and Waku v2 is even larger.\nThe following figure shows comparative average bandwidth usage for a throughput of 50 messages per second.\n\n![](//img/waku1-vs-waku2/waku1-vs-waku2-50-nodes.png)\n\nAverage bandwidth usage (for the same message rate) has remained roughly the same for Waku v2 as it was for 30 nodes,\nindicating that the number of full-message peerings per node has not increased.\n\n### Iteration 4: 85 nodes\n\nWe already see a clear trend in the bandwidth comparisons above,\nso let's confirm by running the test once more for a network of 85 nodes.\nDue to local resource constraints, the effective throughput for Waku v1 falls to below 50 messages per second,\nso the v1 results below have been normalized and are therefore approximate.\nThe local Waku v2 simulation maintains the message throughput rate without any problems.\n\n![](//img/waku1-vs-waku2/waku1-vs-waku2-85-nodes.png)\n\n### Iteration 5: 150 nodes\n\nFinally, we simulate message propagation in a network of 150 nodes.\nDue to local resource constraints, we run this simulation at a lower rate -\n35 messages per second -\nand for a shorter amount of time. \n\n![](//img/waku1-vs-waku2/waku1-vs-waku2-150-nodes.png)\n\nNotice how the Waku v1 bandwidth usage is now more than 10 times worse than that of Waku v2.\nThis is to be expected, as each Waku v1 node will try to flood each new message to 149 other peers,\nwhile the Waku v2 nodes limit their full-message peerings to no more than 12.\n\n### Discussion\n\nLet's summarize average bandwidth growth against network growth for a constant message propagation rate.\nSince we are particularly interested in how Waku v1 compares to Waku v2 in terms of bandwidth usage,\nthe results are normalised to the Waku v2 average bandwidth usage for each network size.\n\n![](//img/waku1-vs-waku2/waku1-vs-waku2-overall-network-size.png)\n\nExtrapolation is a dangerous game,\nbut it's safe to deduce that the divergence will only grow for even larger network topologies.\nAlthough control signalling contributes more towards overall bandwidth for Waku v2 networks,\nthis effect becomes less noticeable for larger networks.\nFor network segments with more than ~18 densely connected nodes,\nthe advantage of using Waku v2 above Waku v1 becomes clear.\n\n## Network traffic comparison\n\nThe analysis above controls the average message rate while network size grows.\nIn reality, however, active users (and therefore message rates) are likely to grow in conjunction with the network.\nThis will have an effect on bandwidth for both Waku v1 and Waku v2, though not in equal measure.\nConsider the impact of an increasing rate of messages in a network of constant size:\n\n![](//img/waku1-vs-waku2/waku1-vs-waku2-overall-message-rate.png)\n\nThe _rate_ of increase in bandwidth for Waku v2 is slower than that for Waku v1 for a corresponding increase in message propagation rate.\nIn fact, for a network of 30 densely-connected nodes,\nif the message propagation rate increases by 1 per second,\nWaku v1 requires an increased average bandwidth of almost 70kbps at each node.\nA similar traffic increase in Waku v2 requires on average 40kbps more bandwidth per peer, just over half that of Waku v1.\n\n## Conclusions\n\n- **Waku v2 scales significantly better than Waku v1 in terms of average bandwidth usage**,\nespecially for densely connected networks.\n- E.g. for a network consisting of **150** or more densely connected nodes,\nWaku v2 provides more than **10x** better average bandwidth usage rates than Waku v1.\n- As the network continues to scale, both in absolute terms (number of nodes) and in network traffic (message rates) the disparity between Waku v2 and Waku v1 becomes even larger.\n\n## Future work\n\nNow that we've confirmed that Waku v2's bandwidth improvements over its predecessor matches theory,\nwe can proceed to a more in-depth characterisation of Waku v2's resource usage.\nSome questions that we want to answer include:\n- What proportion of Waku v2's bandwidth usage is used to propagate _payload_ versus bandwidth spent on _control_ messaging to maintain the mesh?\n- To what extent is message latency (time until a message is delivered to its destination) affected by network size and message rate?\n- How _reliable_ is message delivery in Waku v2 for different network sizes and message rates?\n- What are the resource usage profiles of other Waku v2 protocols (e.g.[`12/WAKU2-FILTER`](https://rfc.vac.dev/spec/12/) and [`19/WAKU2-LIGHTPUSH`](https://rfc.vac.dev/spec/19/))?\n\nOur aim is to get ever closer to a \"real world\" understanding of Waku v2's performance characteristics,\nidentify and fix vulnerabilities\nand continually improve the efficiency of our suite of protocols.\n\n## References\n\n- [Evaluation of GossipSub v1.1](https://research.protocol.ai/publications/gossipsub-v1.1-evaluation-report/vyzovitis2020.pdf)\n- [Fixing Whisper with Waku](https://vac.dev/fixing-whisper-with-waku)\n- [GossipSub vs flood routing](https://hackmd.io/@vac/main/%2FYYlZYBCURFyO_ZG1EiteWg#11WAKU2-RELAY-gossipsub)\n- [Network topologies: star](https://www.techopedia.com/definition/13335/star-topology#:~:text=Star%20topology%20is%20a%20network,known%20as%20a%20star%20network.)\n- [Network topologies: mesh](https://en.wikipedia.org/wiki/Mesh_networking)\n- [Waku v2 original plan](https://vac.dev/waku-v2-plan)","metadata":{"layout":"post","name":"Waku v1 vs Waku v2: Bandwidth Comparison","title":"Waku v1 vs Waku v2: Bandwidth Comparison","date":"2021-11-03T10:00:00.000Z","author":"hanno","published":true,"permalink":"/waku-v1-v2-bandwidth-comparison","categories":"research","summary":"A local comparison of bandwidth profiles showing significantly improved scalability in Waku v2 over Waku v1.","image":"/img/waku1-vs-waku2/waku1-vs-waku2-overall-network-size.png","discuss":"https://forum.vac.dev/t/discussion-waku-v1-vs-waku-v2-bandwidth-comparison/110"},"toc":[{"content":"Background","slug":"background","lvl":2,"i":0,"seen":0},{"content":"Theoretical improvements in Waku v2","slug":"theoretical-improvements-in-waku-v2","lvl":2,"i":1,"seen":0},{"content":"Methodology","slug":"methodology","lvl":2,"i":2,"seen":0},{"content":"Network size comparison","slug":"network-size-comparison","lvl":2,"i":3,"seen":0},{"content":"Iteration 1: 10 nodes","slug":"iteration-1-10-nodes","lvl":3,"i":4,"seen":0},{"content":"Iteration 2: 30 nodes","slug":"iteration-2-30-nodes","lvl":3,"i":5,"seen":0},{"content":"Iteration 3: 50 nodes","slug":"iteration-3-50-nodes","lvl":3,"i":6,"seen":0},{"content":"Iteration 4: 85 nodes","slug":"iteration-4-85-nodes","lvl":3,"i":7,"seen":0},{"content":"Iteration 5: 150 nodes","slug":"iteration-5-150-nodes","lvl":3,"i":8,"seen":0},{"content":"Discussion","slug":"discussion","lvl":3,"i":9,"seen":0},{"content":"Network traffic comparison","slug":"network-traffic-comparison","lvl":2,"i":10,"seen":0},{"content":"Conclusions","slug":"conclusions","lvl":2,"i":11,"seen":0},{"content":"Future work","slug":"future-work","lvl":2,"i":12,"seen":0},{"content":"References","slug":"references","lvl":2,"i":13,"seen":0}]},"navProps":{"metadata":{"published":true,"title":"Waku v1 vs Waku v2: Bandwidth Comparison","layout":"post","name":"Waku v1 vs Waku v2: Bandwidth Comparison","date":"2021-11-03T10:00:00.000Z","author":"hanno","permalink":"/waku-v1-v2-bandwidth-comparison","categories":"research","summary":"A local comparison of bandwidth profiles showing significantly improved scalability in Waku v2 over Waku v1.","image":"img/waku1-vs-waku2/waku1-vs-waku2-overall-network-size.png","discuss":"https://forum.vac.dev/t/discussion-waku-v1-vs-waku-v2-bandwidth-comparison/110"},"navOrder":1635933600,"localPath":"research/2021-10-25-waku-v1-vs-waku-v2.md","path":["waku-v1-v2-bandwidth-comparison"],"children":[],"isDir":false},"routeParams":{"path":["waku-v1-v2-bandwidth-comparison"]}},"__N_SSG":true},"page":"/[[...path]]","query":{"path":["waku-v1-v2-bandwidth-comparison"]},"buildId":"8KpGkiJW7RjczljzY8he_","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>